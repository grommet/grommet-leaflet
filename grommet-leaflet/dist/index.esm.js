"use client";import Ee from"react";import Xe from"prop-types";import it,{ThemeContext as hr}from"styled-components";import{Box as fr,Text as ur}from"grommet";import{deepMerge as lr}from"grommet/utils";var ke=e=>{let r={};return e.forEach(i=>{r=lr(r,i)}),r};var dr=it(fr)`
  // translate to re-align with leaflet div
  transform: translateX(-35%);
  &:hover {
    transform: translateX(-35%) scale(1.1);
    transition: transform 0.4s;
  }
`,cr=it(ur)`
  // multiplier of font-size, for tighter alignment
  line-height: 1rem;
`,Ye=({cluster:e,kind:r="default",size:i="medium",...t})=>{var f,u,p,g,x,w,_,M,T,d,m,y,z;let n=Ee.useContext(hr),s=ke([(p=(u=(f=n==null?void 0:n.map)==null?void 0:f.cluster)==null?void 0:u.size)==null?void 0:p.medium,(w=(x=(g=n==null?void 0:n.map)==null?void 0:g.cluster)==null?void 0:x.size)==null?void 0:w[i],(M=(_=n==null?void 0:n.map)==null?void 0:_.cluster)==null?void 0:M.default,(d=(T=n==null?void 0:n.map)==null?void 0:T.cluster)==null?void 0:d[r]]),a=e.getChildCount(),o=(z=(y=(m=n==null?void 0:n.map)==null?void 0:m.cluster)==null?void 0:y[r])==null?void 0:z.icon,h=a;return Ee.createElement(dr,{...s==null?void 0:s.container,...t},o,Ee.createElement(cr,{...s==null?void 0:s.label},h))};Ye.propTypes={cluster:Xe.object,kind:Xe.string,size:Xe.string};import ee from"react";import Ve from"prop-types";import{useMap as pr}from"react-leaflet";import mr from"leaflet";import{Box as Me,Button as Ie}from"grommet";import{Add as yr,Subtract as gr,Globe as vr}from"grommet-icons";var xr=({locations:e})=>{let r=mr.latLngBounds();return e.features?e.features.forEach(i=>{var t,n;r.extend([(t=i.geometry)==null?void 0:t.coordinates[0],(n=i.geometry)==null?void 0:n.coordinates[1]])}):e.forEach(i=>{r.extend([i==null?void 0:i[0],i==null?void 0:i[1]])}),r},wr=1.5,_r=({locations:e})=>{let r=pr(),i=e&&xr({locations:e});return i&&(JSON.stringify(i._northEast)===JSON.stringify(i._southWest)||r.flyToBounds(i,{duration:wr})),ee.createElement(Me,{className:"leaflet-bottom leaflet-right"},ee.createElement(Me,{className:"leaflet-control"},ee.createElement(Me,{elevation:"large",round:"medium",background:"background"},ee.createElement(Ie,{a11yTitle:"Zoom in",icon:ee.createElement(yr,null),onClick:t=>{t.preventDefault(),r.zoomIn()}}),ee.createElement(Ie,{a11yTitle:"Zoom out",icon:ee.createElement(gr,null),onClick:t=>{t.preventDefault(),r.zoomOut()}}),ee.createElement(Me,{border:{color:"border-weak",side:"top"}},i&&ee.createElement(Ie,{a11yTitle:"Zoom to data",icon:ee.createElement(vr,null),onClick:t=>{t.preventDefault(),r.flyToBounds(i,{duration:1.5})}})))))};_r.propTypes={locations:Ve.oneOfType([Ve.array,Ve.object])};import De,{forwardRef as xn,useContext as wn}from"react";import J from"prop-types";import{MapContainer as _n,AttributionControl as bn}from"react-leaflet";import zn,{ThemeContext as tr}from"styled-components";import{deepMerge as rr}from"grommet/utils";import{deepMerge as br}from"grommet/utils";var nt={default:{container:{align:"center",justify:"center",background:"background-front",border:{color:"border",size:"small"},elevation:"medium",flex:!1,round:"full"}}},zr=br(nt,{default:{container:{height:{min:"25px",max:"25px"},width:{min:"25px",max:"25px"}}}}),st={pin:{...zr},cluster:{...nt,size:{small:{container:{height:{min:"36px",max:"36px"},width:{min:"36px",max:"36px"}},label:{size:"small"}},medium:{container:{direction:"row-reverse",gap:"xxsmall",height:{min:"48px",max:"48px"},width:{min:"48px",max:"48px"}},label:{color:"text-strong",size:"medium",weight:500}},large:{container:{direction:"row-reverse",gap:"xxsmall",height:{min:"54px",max:"54px"},width:{min:"54px",max:"54px"}},label:{size:"medium"}}}},popup:{background:"background-front",border:{color:"border-weak",size:"xsmall"},gap:"xsmall",margin:"none",pad:"small",round:"xsmall"}};var kr=Object.create,Be=Object.defineProperty,Mr=Object.getOwnPropertyDescriptor,Lr=Object.getOwnPropertyNames,at=Object.getOwnPropertySymbols,Cr=Object.getPrototypeOf,St=Object.prototype.hasOwnProperty,Tr=Object.prototype.propertyIsEnumerable,ot=(e,r,i)=>r in e?Be(e,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[r]=i,Sr=(e,r)=>{for(var i in r||(r={}))St.call(r,i)&&ot(e,i,r[i]);if(at)for(var i of at(r))Tr.call(r,i)&&ot(e,i,r[i]);return e},Fr=e=>Be(e,"__esModule",{value:!0}),G=(e,r)=>function(){return r||(0,e[Object.keys(e)[0]])((r={exports:{}}).exports,r),r.exports},Br=(e,r,i)=>{if(r&&typeof r=="object"||typeof r=="function")for(let t of Lr(r))!St.call(e,t)&&t!=="default"&&Be(e,t,{get:()=>r[t],enumerable:!(i=Mr(r,t))||i.enumerable});return e},W=e=>Br(Fr(Be(e!=null?kr(Cr(e)):{},"default",e&&e.__esModule&&"default"in e?{get:()=>e.default,enumerable:!0}:{value:e,enumerable:!0})),e),de=(e,r,i)=>new Promise((t,n)=>{var s=h=>{try{o(i.next(h))}catch(f){n(f)}},a=h=>{try{o(i.throw(h))}catch(f){n(f)}},o=h=>h.done?t(h.value):Promise.resolve(h.value).then(s,a);o((i=i.apply(e,r)).next())}),ie=G({"node_modules/@mapbox/point-geometry/index.js"(e,r){"use strict";r.exports=i;function i(t,n){this.x=t,this.y=n}i.prototype={clone:function(){return new i(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,n){return this.clone()._rotateAround(t,n)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var n=t.x-this.x,s=t.y-this.y;return n*n+s*s},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,n){return Math.atan2(this.x*n-this.y*t,this.x*t+this.y*n)},_matMult:function(t){var n=t[0]*this.x+t[1]*this.y,s=t[2]*this.x+t[3]*this.y;return this.x=n,this.y=s,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var n=Math.cos(t),s=Math.sin(t),a=n*this.x-s*this.y,o=s*this.x+n*this.y;return this.x=a,this.y=o,this},_rotateAround:function(t,n){var s=Math.cos(t),a=Math.sin(t),o=n.x+s*(this.x-n.x)-a*(this.y-n.y),h=n.y+a*(this.x-n.x)+s*(this.y-n.y);return this.x=o,this.y=h,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},i.convert=function(t){return t instanceof i?t:Array.isArray(t)?new i(t[0],t[1]):t}}}),Ft=G({"node_modules/@mapbox/vector-tile/lib/vectortilefeature.js"(e,r){"use strict";var i=ie();r.exports=t;function t(h,f,u,p,g){this.properties={},this.extent=u,this.type=0,this._pbf=h,this._geometry=-1,this._keys=p,this._values=g,h.readFields(n,this,f)}function n(h,f,u){h==1?f.id=u.readVarint():h==2?s(u,f):h==3?f.type=u.readVarint():h==4&&(f._geometry=u.pos)}function s(h,f){for(var u=h.readVarint()+h.pos;h.pos<u;){var p=f._keys[h.readVarint()],g=f._values[h.readVarint()];f.properties[p]=g}}t.types=["Unknown","Point","LineString","Polygon"],t.prototype.loadGeometry=function(){var h=this._pbf;h.pos=this._geometry;for(var f=h.readVarint()+h.pos,u=1,p=0,g=0,x=0,w=[],_;h.pos<f;){if(p<=0){var M=h.readVarint();u=M&7,p=M>>3}if(p--,u===1||u===2)g+=h.readSVarint(),x+=h.readSVarint(),u===1&&(_&&w.push(_),_=[]),_.push(new i(g,x));else if(u===7)_&&_.push(_[0].clone());else throw new Error("unknown command "+u)}return _&&w.push(_),w},t.prototype.bbox=function(){var h=this._pbf;h.pos=this._geometry;for(var f=h.readVarint()+h.pos,u=1,p=0,g=0,x=0,w=1/0,_=-1/0,M=1/0,T=-1/0;h.pos<f;){if(p<=0){var d=h.readVarint();u=d&7,p=d>>3}if(p--,u===1||u===2)g+=h.readSVarint(),x+=h.readSVarint(),g<w&&(w=g),g>_&&(_=g),x<M&&(M=x),x>T&&(T=x);else if(u!==7)throw new Error("unknown command "+u)}return[w,M,_,T]},t.prototype.toGeoJSON=function(h,f,u){var p=this.extent*Math.pow(2,u),g=this.extent*h,x=this.extent*f,w=this.loadGeometry(),_=t.types[this.type],M,T;function d(z){for(var k=0;k<z.length;k++){var b=z[k],C=180-(b.y+x)*360/p;z[k]=[(b.x+g)*360/p-180,360/Math.PI*Math.atan(Math.exp(C*Math.PI/180))-90]}}switch(this.type){case 1:var m=[];for(M=0;M<w.length;M++)m[M]=w[M][0];w=m,d(w);break;case 2:for(M=0;M<w.length;M++)d(w[M]);break;case 3:for(w=a(w),M=0;M<w.length;M++)for(T=0;T<w[M].length;T++)d(w[M][T]);break}w.length===1?w=w[0]:_="Multi"+_;var y={type:"Feature",geometry:{type:_,coordinates:w},properties:this.properties};return"id"in this&&(y.id=this.id),y};function a(h){var f=h.length;if(f<=1)return[h];for(var u=[],p,g,x=0;x<f;x++){var w=o(h[x]);w!==0&&(g===void 0&&(g=w<0),g===w<0?(p&&u.push(p),p=[h[x]]):p.push(h[x]))}return p&&u.push(p),u}function o(h){for(var f=0,u=0,p=h.length,g=p-1,x,w;u<p;g=u++)x=h[u],w=h[g],f+=(w.x-x.x)*(x.y+w.y);return f}}}),Bt=G({"node_modules/@mapbox/vector-tile/lib/vectortilelayer.js"(e,r){"use strict";var i=Ft();r.exports=t;function t(a,o){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=a,this._keys=[],this._values=[],this._features=[],a.readFields(n,this,o),this.length=this._features.length}function n(a,o,h){a===15?o.version=h.readVarint():a===1?o.name=h.readString():a===5?o.extent=h.readVarint():a===2?o._features.push(h.pos):a===3?o._keys.push(h.readString()):a===4&&o._values.push(s(h))}function s(a){for(var o=null,h=a.readVarint()+a.pos;a.pos<h;){var f=a.readVarint()>>3;o=f===1?a.readString():f===2?a.readFloat():f===3?a.readDouble():f===4?a.readVarint64():f===5?a.readVarint():f===6?a.readSVarint():f===7?a.readBoolean():null}return o}t.prototype.feature=function(a){if(a<0||a>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[a];var o=this._pbf.readVarint()+this._pbf.pos;return new i(this._pbf,o,this.extent,this._keys,this._values)}}}),Dr=G({"node_modules/@mapbox/vector-tile/lib/vectortile.js"(e,r){"use strict";var i=Bt();r.exports=t;function t(s,a){this.layers=s.readFields(n,{},a)}function n(s,a,o){if(s===3){var h=new i(o,o.readVarint()+o.pos);h.length&&(a[h.name]=h)}}}}),Pr=G({"node_modules/@mapbox/vector-tile/index.js"(e,r){r.exports.VectorTile=Dr(),r.exports.VectorTileFeature=Ft(),r.exports.VectorTileLayer=Bt()}}),Er=G({"node_modules/ieee754/index.js"(e){e.read=function(r,i,t,n,s){var a,o,h=s*8-n-1,f=(1<<h)-1,u=f>>1,p=-7,g=t?s-1:0,x=t?-1:1,w=r[i+g];for(g+=x,a=w&(1<<-p)-1,w>>=-p,p+=h;p>0;a=a*256+r[i+g],g+=x,p-=8);for(o=a&(1<<-p)-1,a>>=-p,p+=n;p>0;o=o*256+r[i+g],g+=x,p-=8);if(a===0)a=1-u;else{if(a===f)return o?NaN:(w?-1:1)*(1/0);o=o+Math.pow(2,n),a=a-u}return(w?-1:1)*o*Math.pow(2,a-n)},e.write=function(r,i,t,n,s,a){var o,h,f,u=a*8-s-1,p=(1<<u)-1,g=p>>1,x=s===23?Math.pow(2,-24)-Math.pow(2,-77):0,w=n?0:a-1,_=n?1:-1,M=i<0||i===0&&1/i<0?1:0;for(i=Math.abs(i),isNaN(i)||i===1/0?(h=isNaN(i)?1:0,o=p):(o=Math.floor(Math.log(i)/Math.LN2),i*(f=Math.pow(2,-o))<1&&(o--,f*=2),o+g>=1?i+=x/f:i+=x*Math.pow(2,1-g),i*f>=2&&(o++,f/=2),o+g>=p?(h=0,o=p):o+g>=1?(h=(i*f-1)*Math.pow(2,s),o=o+g):(h=i*Math.pow(2,g-1)*Math.pow(2,s),o=0));s>=8;r[t+w]=h&255,w+=_,h/=256,s-=8);for(o=o<<s|h,u+=s;u>0;r[t+w]=o&255,w+=_,o/=256,u-=8);r[t+w-_]|=M*128}}}),Xr=G({"node_modules/pbf/index.js"(e,r){"use strict";r.exports=t;var i=Er();function t(l){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(l)?l:new Uint8Array(l||0),this.pos=0,this.type=0,this.length=this.buf.length}t.Varint=0,t.Fixed64=1,t.Bytes=2,t.Fixed32=5;var n=65536*65536,s=1/n,a=12,o=typeof TextDecoder>"u"?null:new TextDecoder("utf8");t.prototype={destroy:function(){this.buf=null},readFields:function(l,c,v){for(v=v||this.length;this.pos<v;){var F=this.readVarint(),S=F>>3,E=this.pos;this.type=F&7,l(S,c,this),this.pos===E&&this.skip(F)}return c},readMessage:function(l,c){return this.readFields(l,c,this.readVarint()+this.pos)},readFixed32:function(){var l=C(this.buf,this.pos);return this.pos+=4,l},readSFixed32:function(){var l=D(this.buf,this.pos);return this.pos+=4,l},readFixed64:function(){var l=C(this.buf,this.pos)+C(this.buf,this.pos+4)*n;return this.pos+=8,l},readSFixed64:function(){var l=C(this.buf,this.pos)+D(this.buf,this.pos+4)*n;return this.pos+=8,l},readFloat:function(){var l=i.read(this.buf,this.pos,!0,23,4);return this.pos+=4,l},readDouble:function(){var l=i.read(this.buf,this.pos,!0,52,8);return this.pos+=8,l},readVarint:function(l){var c=this.buf,v,F;return F=c[this.pos++],v=F&127,F<128||(F=c[this.pos++],v|=(F&127)<<7,F<128)||(F=c[this.pos++],v|=(F&127)<<14,F<128)||(F=c[this.pos++],v|=(F&127)<<21,F<128)?v:(F=c[this.pos],v|=(F&15)<<28,h(v,l,this))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var l=this.readVarint();return l%2===1?(l+1)/-2:l/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var l=this.readVarint()+this.pos,c=this.pos;return this.pos=l,l-c>=a&&o?I(this.buf,c,l):X(this.buf,c,l)},readBytes:function(){var l=this.readVarint()+this.pos,c=this.buf.subarray(this.pos,l);return this.pos=l,c},readPackedVarint:function(l,c){if(this.type!==t.Bytes)return l.push(this.readVarint(c));var v=f(this);for(l=l||[];this.pos<v;)l.push(this.readVarint(c));return l},readPackedSVarint:function(l){if(this.type!==t.Bytes)return l.push(this.readSVarint());var c=f(this);for(l=l||[];this.pos<c;)l.push(this.readSVarint());return l},readPackedBoolean:function(l){if(this.type!==t.Bytes)return l.push(this.readBoolean());var c=f(this);for(l=l||[];this.pos<c;)l.push(this.readBoolean());return l},readPackedFloat:function(l){if(this.type!==t.Bytes)return l.push(this.readFloat());var c=f(this);for(l=l||[];this.pos<c;)l.push(this.readFloat());return l},readPackedDouble:function(l){if(this.type!==t.Bytes)return l.push(this.readDouble());var c=f(this);for(l=l||[];this.pos<c;)l.push(this.readDouble());return l},readPackedFixed32:function(l){if(this.type!==t.Bytes)return l.push(this.readFixed32());var c=f(this);for(l=l||[];this.pos<c;)l.push(this.readFixed32());return l},readPackedSFixed32:function(l){if(this.type!==t.Bytes)return l.push(this.readSFixed32());var c=f(this);for(l=l||[];this.pos<c;)l.push(this.readSFixed32());return l},readPackedFixed64:function(l){if(this.type!==t.Bytes)return l.push(this.readFixed64());var c=f(this);for(l=l||[];this.pos<c;)l.push(this.readFixed64());return l},readPackedSFixed64:function(l){if(this.type!==t.Bytes)return l.push(this.readSFixed64());var c=f(this);for(l=l||[];this.pos<c;)l.push(this.readSFixed64());return l},skip:function(l){var c=l&7;if(c===t.Varint)for(;this.buf[this.pos++]>127;);else if(c===t.Bytes)this.pos=this.readVarint()+this.pos;else if(c===t.Fixed32)this.pos+=4;else if(c===t.Fixed64)this.pos+=8;else throw new Error("Unimplemented type: "+c)},writeTag:function(l,c){this.writeVarint(l<<3|c)},realloc:function(l){for(var c=this.length||16;c<this.pos+l;)c*=2;if(c!==this.length){var v=new Uint8Array(c);v.set(this.buf),this.buf=v,this.length=c}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(l){this.realloc(4),B(this.buf,l,this.pos),this.pos+=4},writeSFixed32:function(l){this.realloc(4),B(this.buf,l,this.pos),this.pos+=4},writeFixed64:function(l){this.realloc(8),B(this.buf,l&-1,this.pos),B(this.buf,Math.floor(l*s),this.pos+4),this.pos+=8},writeSFixed64:function(l){this.realloc(8),B(this.buf,l&-1,this.pos),B(this.buf,Math.floor(l*s),this.pos+4),this.pos+=8},writeVarint:function(l){if(l=+l||0,l>268435455||l<0){p(l,this);return}this.realloc(4),this.buf[this.pos++]=l&127|(l>127?128:0),!(l<=127)&&(this.buf[this.pos++]=(l>>>=7)&127|(l>127?128:0),!(l<=127)&&(this.buf[this.pos++]=(l>>>=7)&127|(l>127?128:0),!(l<=127)&&(this.buf[this.pos++]=l>>>7&127)))},writeSVarint:function(l){this.writeVarint(l<0?-l*2-1:l*2)},writeBoolean:function(l){this.writeVarint(!!l)},writeString:function(l){l=String(l),this.realloc(l.length*4),this.pos++;var c=this.pos;this.pos=P(this.buf,l,this.pos);var v=this.pos-c;v>=128&&w(c,v,this),this.pos=c-1,this.writeVarint(v),this.pos+=v},writeFloat:function(l){this.realloc(4),i.write(this.buf,l,this.pos,!0,23,4),this.pos+=4},writeDouble:function(l){this.realloc(8),i.write(this.buf,l,this.pos,!0,52,8),this.pos+=8},writeBytes:function(l){var c=l.length;this.writeVarint(c),this.realloc(c);for(var v=0;v<c;v++)this.buf[this.pos++]=l[v]},writeRawMessage:function(l,c){this.pos++;var v=this.pos;l(c,this);var F=this.pos-v;F>=128&&w(v,F,this),this.pos=v-1,this.writeVarint(F),this.pos+=F},writeMessage:function(l,c,v){this.writeTag(l,t.Bytes),this.writeRawMessage(c,v)},writePackedVarint:function(l,c){c.length&&this.writeMessage(l,_,c)},writePackedSVarint:function(l,c){c.length&&this.writeMessage(l,M,c)},writePackedBoolean:function(l,c){c.length&&this.writeMessage(l,m,c)},writePackedFloat:function(l,c){c.length&&this.writeMessage(l,T,c)},writePackedDouble:function(l,c){c.length&&this.writeMessage(l,d,c)},writePackedFixed32:function(l,c){c.length&&this.writeMessage(l,y,c)},writePackedSFixed32:function(l,c){c.length&&this.writeMessage(l,z,c)},writePackedFixed64:function(l,c){c.length&&this.writeMessage(l,k,c)},writePackedSFixed64:function(l,c){c.length&&this.writeMessage(l,b,c)},writeBytesField:function(l,c){this.writeTag(l,t.Bytes),this.writeBytes(c)},writeFixed32Field:function(l,c){this.writeTag(l,t.Fixed32),this.writeFixed32(c)},writeSFixed32Field:function(l,c){this.writeTag(l,t.Fixed32),this.writeSFixed32(c)},writeFixed64Field:function(l,c){this.writeTag(l,t.Fixed64),this.writeFixed64(c)},writeSFixed64Field:function(l,c){this.writeTag(l,t.Fixed64),this.writeSFixed64(c)},writeVarintField:function(l,c){this.writeTag(l,t.Varint),this.writeVarint(c)},writeSVarintField:function(l,c){this.writeTag(l,t.Varint),this.writeSVarint(c)},writeStringField:function(l,c){this.writeTag(l,t.Bytes),this.writeString(c)},writeFloatField:function(l,c){this.writeTag(l,t.Fixed32),this.writeFloat(c)},writeDoubleField:function(l,c){this.writeTag(l,t.Fixed64),this.writeDouble(c)},writeBooleanField:function(l,c){this.writeVarintField(l,!!c)}};function h(l,c,v){var F=v.buf,S,E;if(E=F[v.pos++],S=(E&112)>>4,E<128||(E=F[v.pos++],S|=(E&127)<<3,E<128)||(E=F[v.pos++],S|=(E&127)<<10,E<128)||(E=F[v.pos++],S|=(E&127)<<17,E<128)||(E=F[v.pos++],S|=(E&127)<<24,E<128)||(E=F[v.pos++],S|=(E&1)<<31,E<128))return u(l,S,c);throw new Error("Expected varint not more than 10 bytes")}function f(l){return l.type===t.Bytes?l.readVarint()+l.pos:l.pos+1}function u(l,c,v){return v?c*4294967296+(l>>>0):(c>>>0)*4294967296+(l>>>0)}function p(l,c){var v,F;if(l>=0?(v=l%4294967296|0,F=l/4294967296|0):(v=~(-l%4294967296),F=~(-l/4294967296),v^4294967295?v=v+1|0:(v=0,F=F+1|0)),l>=18446744073709552e3||l<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");c.realloc(10),g(v,F,c),x(F,c)}function g(l,c,v){v.buf[v.pos++]=l&127|128,l>>>=7,v.buf[v.pos++]=l&127|128,l>>>=7,v.buf[v.pos++]=l&127|128,l>>>=7,v.buf[v.pos++]=l&127|128,l>>>=7,v.buf[v.pos]=l&127}function x(l,c){var v=(l&7)<<4;c.buf[c.pos++]|=v|((l>>>=3)?128:0),l&&(c.buf[c.pos++]=l&127|((l>>>=7)?128:0),l&&(c.buf[c.pos++]=l&127|((l>>>=7)?128:0),l&&(c.buf[c.pos++]=l&127|((l>>>=7)?128:0),l&&(c.buf[c.pos++]=l&127|((l>>>=7)?128:0),l&&(c.buf[c.pos++]=l&127)))))}function w(l,c,v){var F=c<=16383?1:c<=2097151?2:c<=268435455?3:Math.floor(Math.log(c)/(Math.LN2*7));v.realloc(F);for(var S=v.pos-1;S>=l;S--)v.buf[S+F]=v.buf[S]}function _(l,c){for(var v=0;v<l.length;v++)c.writeVarint(l[v])}function M(l,c){for(var v=0;v<l.length;v++)c.writeSVarint(l[v])}function T(l,c){for(var v=0;v<l.length;v++)c.writeFloat(l[v])}function d(l,c){for(var v=0;v<l.length;v++)c.writeDouble(l[v])}function m(l,c){for(var v=0;v<l.length;v++)c.writeBoolean(l[v])}function y(l,c){for(var v=0;v<l.length;v++)c.writeFixed32(l[v])}function z(l,c){for(var v=0;v<l.length;v++)c.writeSFixed32(l[v])}function k(l,c){for(var v=0;v<l.length;v++)c.writeFixed64(l[v])}function b(l,c){for(var v=0;v<l.length;v++)c.writeSFixed64(l[v])}function C(l,c){return(l[c]|l[c+1]<<8|l[c+2]<<16)+l[c+3]*16777216}function B(l,c,v){l[v]=c,l[v+1]=c>>>8,l[v+2]=c>>>16,l[v+3]=c>>>24}function D(l,c){return(l[c]|l[c+1]<<8|l[c+2]<<16)+(l[c+3]<<24)}function X(l,c,v){for(var F="",S=c;S<v;){var E=l[S],Y=null,j=E>239?4:E>223?3:E>191?2:1;if(S+j>v)break;var A,Q,se;j===1?E<128&&(Y=E):j===2?(A=l[S+1],(A&192)===128&&(Y=(E&31)<<6|A&63,Y<=127&&(Y=null))):j===3?(A=l[S+1],Q=l[S+2],(A&192)===128&&(Q&192)===128&&(Y=(E&15)<<12|(A&63)<<6|Q&63,(Y<=2047||Y>=55296&&Y<=57343)&&(Y=null))):j===4&&(A=l[S+1],Q=l[S+2],se=l[S+3],(A&192)===128&&(Q&192)===128&&(se&192)===128&&(Y=(E&15)<<18|(A&63)<<12|(Q&63)<<6|se&63,(Y<=65535||Y>=1114112)&&(Y=null))),Y===null?(Y=65533,j=1):Y>65535&&(Y-=65536,F+=String.fromCharCode(Y>>>10&1023|55296),Y=56320|Y&1023),F+=String.fromCharCode(Y),S+=j}return F}function I(l,c,v){return o.decode(l.subarray(c,v))}function P(l,c,v){for(var F=0,S,E;F<c.length;F++){if(S=c.charCodeAt(F),S>55295&&S<57344)if(E)if(S<56320){l[v++]=239,l[v++]=191,l[v++]=189,E=S;continue}else S=E-55296<<10|S-56320|65536,E=null;else{S>56319||F+1===c.length?(l[v++]=239,l[v++]=191,l[v++]=189):E=S;continue}else E&&(l[v++]=239,l[v++]=191,l[v++]=189,E=null);S<128?l[v++]=S:(S<2048?l[v++]=S>>6|192:(S<65536?l[v++]=S>>12|224:(l[v++]=S>>18|240,l[v++]=S>>12&63|128),l[v++]=S>>6&63|128),l[v++]=S&63|128)}return v}}}),Yr=G({"node_modules/rbush/rbush.min.js"(e,r){(function(i,t){typeof e=="object"&&typeof r<"u"?r.exports=t():typeof define=="function"&&define.amd?define(t):(i=i||self).RBush=t()})(e,function(){"use strict";function i(d,m,y,z,k){(function b(C,B,D,X,I){for(;X>D;){if(X-D>600){var P=X-D+1,l=B-D+1,c=Math.log(P),v=.5*Math.exp(2*c/3),F=.5*Math.sqrt(c*v*(P-v)/P)*(l-P/2<0?-1:1),S=Math.max(D,Math.floor(B-l*v/P+F)),E=Math.min(X,Math.floor(B+(P-l)*v/P+F));b(C,B,S,E,I)}var Y=C[B],j=D,A=X;for(t(C,D,B),I(C[X],Y)>0&&t(C,D,X);j<A;){for(t(C,j,A),j++,A--;I(C[j],Y)<0;)j++;for(;I(C[A],Y)>0;)A--}I(C[D],Y)===0?t(C,D,A):t(C,++A,X),A<=B&&(D=A+1),B<=A&&(X=A-1)}})(d,m,y||0,z||d.length-1,k||n)}function t(d,m,y){var z=d[m];d[m]=d[y],d[y]=z}function n(d,m){return d<m?-1:d>m?1:0}var s=function(d){d===void 0&&(d=9),this._maxEntries=Math.max(4,d),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function a(d,m,y){if(!y)return m.indexOf(d);for(var z=0;z<m.length;z++)if(y(d,m[z]))return z;return-1}function o(d,m){h(d,0,d.children.length,m,d)}function h(d,m,y,z,k){k||(k=M(null)),k.minX=1/0,k.minY=1/0,k.maxX=-1/0,k.maxY=-1/0;for(var b=m;b<y;b++){var C=d.children[b];f(k,d.leaf?z(C):C)}return k}function f(d,m){return d.minX=Math.min(d.minX,m.minX),d.minY=Math.min(d.minY,m.minY),d.maxX=Math.max(d.maxX,m.maxX),d.maxY=Math.max(d.maxY,m.maxY),d}function u(d,m){return d.minX-m.minX}function p(d,m){return d.minY-m.minY}function g(d){return(d.maxX-d.minX)*(d.maxY-d.minY)}function x(d){return d.maxX-d.minX+(d.maxY-d.minY)}function w(d,m){return d.minX<=m.minX&&d.minY<=m.minY&&m.maxX<=d.maxX&&m.maxY<=d.maxY}function _(d,m){return m.minX<=d.maxX&&m.minY<=d.maxY&&m.maxX>=d.minX&&m.maxY>=d.minY}function M(d){return{children:d,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function T(d,m,y,z,k){for(var b=[m,y];b.length;)if(!((y=b.pop())-(m=b.pop())<=z)){var C=m+Math.ceil((y-m)/z/2)*z;i(d,C,m,y,k),b.push(m,C,C,y)}}return s.prototype.all=function(){return this._all(this.data,[])},s.prototype.search=function(d){var m=this.data,y=[];if(!_(d,m))return y;for(var z=this.toBBox,k=[];m;){for(var b=0;b<m.children.length;b++){var C=m.children[b],B=m.leaf?z(C):C;_(d,B)&&(m.leaf?y.push(C):w(d,B)?this._all(C,y):k.push(C))}m=k.pop()}return y},s.prototype.collides=function(d){var m=this.data;if(!_(d,m))return!1;for(var y=[];m;){for(var z=0;z<m.children.length;z++){var k=m.children[z],b=m.leaf?this.toBBox(k):k;if(_(d,b)){if(m.leaf||w(d,b))return!0;y.push(k)}}m=y.pop()}return!1},s.prototype.load=function(d){if(!d||!d.length)return this;if(d.length<this._minEntries){for(var m=0;m<d.length;m++)this.insert(d[m]);return this}var y=this._build(d.slice(),0,d.length-1,0);if(this.data.children.length)if(this.data.height===y.height)this._splitRoot(this.data,y);else{if(this.data.height<y.height){var z=this.data;this.data=y,y=z}this._insert(y,this.data.height-y.height-1,!0)}else this.data=y;return this},s.prototype.insert=function(d){return d&&this._insert(d,this.data.height-1),this},s.prototype.clear=function(){return this.data=M([]),this},s.prototype.remove=function(d,m){if(!d)return this;for(var y,z,k,b=this.data,C=this.toBBox(d),B=[],D=[];b||B.length;){if(b||(b=B.pop(),z=B[B.length-1],y=D.pop(),k=!0),b.leaf){var X=a(d,b.children,m);if(X!==-1)return b.children.splice(X,1),B.push(b),this._condense(B),this}k||b.leaf||!w(b,C)?z?(y++,b=z.children[y],k=!1):b=null:(B.push(b),D.push(y),y=0,z=b,b=b.children[0])}return this},s.prototype.toBBox=function(d){return d},s.prototype.compareMinX=function(d,m){return d.minX-m.minX},s.prototype.compareMinY=function(d,m){return d.minY-m.minY},s.prototype.toJSON=function(){return this.data},s.prototype.fromJSON=function(d){return this.data=d,this},s.prototype._all=function(d,m){for(var y=[];d;)d.leaf?m.push.apply(m,d.children):y.push.apply(y,d.children),d=y.pop();return m},s.prototype._build=function(d,m,y,z){var k,b=y-m+1,C=this._maxEntries;if(b<=C)return o(k=M(d.slice(m,y+1)),this.toBBox),k;z||(z=Math.ceil(Math.log(b)/Math.log(C)),C=Math.ceil(b/Math.pow(C,z-1))),(k=M([])).leaf=!1,k.height=z;var B=Math.ceil(b/C),D=B*Math.ceil(Math.sqrt(C));T(d,m,y,D,this.compareMinX);for(var X=m;X<=y;X+=D){var I=Math.min(X+D-1,y);T(d,X,I,B,this.compareMinY);for(var P=X;P<=I;P+=B){var l=Math.min(P+B-1,I);k.children.push(this._build(d,P,l,z-1))}}return o(k,this.toBBox),k},s.prototype._chooseSubtree=function(d,m,y,z){for(;z.push(m),!m.leaf&&z.length-1!==y;){for(var k=1/0,b=1/0,C=void 0,B=0;B<m.children.length;B++){var D=m.children[B],X=g(D),I=(P=d,l=D,(Math.max(l.maxX,P.maxX)-Math.min(l.minX,P.minX))*(Math.max(l.maxY,P.maxY)-Math.min(l.minY,P.minY))-X);I<b?(b=I,k=X<k?X:k,C=D):I===b&&X<k&&(k=X,C=D)}m=C||m.children[0]}var P,l;return m},s.prototype._insert=function(d,m,y){var z=y?d:this.toBBox(d),k=[],b=this._chooseSubtree(z,this.data,m,k);for(b.children.push(d),f(b,z);m>=0&&k[m].children.length>this._maxEntries;)this._split(k,m),m--;this._adjustParentBBoxes(z,k,m)},s.prototype._split=function(d,m){var y=d[m],z=y.children.length,k=this._minEntries;this._chooseSplitAxis(y,k,z);var b=this._chooseSplitIndex(y,k,z),C=M(y.children.splice(b,y.children.length-b));C.height=y.height,C.leaf=y.leaf,o(y,this.toBBox),o(C,this.toBBox),m?d[m-1].children.push(C):this._splitRoot(y,C)},s.prototype._splitRoot=function(d,m){this.data=M([d,m]),this.data.height=d.height+1,this.data.leaf=!1,o(this.data,this.toBBox)},s.prototype._chooseSplitIndex=function(d,m,y){for(var z,k,b,C,B,D,X,I=1/0,P=1/0,l=m;l<=y-m;l++){var c=h(d,0,l,this.toBBox),v=h(d,l,y,this.toBBox),F=(k=c,b=v,C=void 0,B=void 0,D=void 0,X=void 0,C=Math.max(k.minX,b.minX),B=Math.max(k.minY,b.minY),D=Math.min(k.maxX,b.maxX),X=Math.min(k.maxY,b.maxY),Math.max(0,D-C)*Math.max(0,X-B)),S=g(c)+g(v);F<I?(I=F,z=l,P=S<P?S:P):F===I&&S<P&&(P=S,z=l)}return z||y-m},s.prototype._chooseSplitAxis=function(d,m,y){var z=d.leaf?this.compareMinX:u,k=d.leaf?this.compareMinY:p;this._allDistMargin(d,m,y,z)<this._allDistMargin(d,m,y,k)&&d.children.sort(z)},s.prototype._allDistMargin=function(d,m,y,z){d.children.sort(z);for(var k=this.toBBox,b=h(d,0,m,k),C=h(d,y-m,y,k),B=x(b)+x(C),D=m;D<y-m;D++){var X=d.children[D];f(b,d.leaf?k(X):X),B+=x(b)}for(var I=y-m-1;I>=m;I--){var P=d.children[I];f(C,d.leaf?k(P):P),B+=x(C)}return B},s.prototype._adjustParentBBoxes=function(d,m,y){for(var z=y;z>=0;z--)f(m[z],d)},s.prototype._condense=function(d){for(var m=d.length-1,y=void 0;m>=0;m--)d[m].children.length===0?m>0?(y=d[m-1].children).splice(y.indexOf(d[m]),1):this.clear():o(d[m],this.toBBox)},s})}}),Vr=G({"src/types/unitbezier.d.ts"(){}}),Ir=G({"node_modules/tinyqueue/tinyqueue.js"(e,r){(function(i,t){typeof e=="object"&&typeof r<"u"?r.exports=t():typeof define=="function"&&define.amd?define(t):(i=i||self,i.TinyQueue=t())})(e,function(){"use strict";var i=function(s,a){if(s===void 0&&(s=[]),a===void 0&&(a=t),this.data=s,this.length=this.data.length,this.compare=a,this.length>0)for(var o=(this.length>>1)-1;o>=0;o--)this._down(o)};i.prototype.push=function(s){this.data.push(s),this.length++,this._up(this.length-1)},i.prototype.pop=function(){if(this.length!==0){var s=this.data[0],a=this.data.pop();return this.length--,this.length>0&&(this.data[0]=a,this._down(0)),s}},i.prototype.peek=function(){return this.data[0]},i.prototype._up=function(s){for(var a=this,o=a.data,h=a.compare,f=o[s];s>0;){var u=s-1>>1,p=o[u];if(h(f,p)>=0)break;o[s]=p,s=u}o[s]=f},i.prototype._down=function(s){for(var a=this,o=a.data,h=a.compare,f=this.length>>1,u=o[s];s<f;){var p=(s<<1)+1,g=o[p],x=p+1;if(x<this.length&&h(o[x],g)<0&&(p=x,g=o[x]),h(g,u)>=0)break;o[s]=g,s=p}o[s]=u};function t(n,s){return n<s?-1:n>s?1:0}return i})}}),Ar=G({"node_modules/polylabel/polylabel.js"(e,r){"use strict";var i=Ir();i.default&&(i=i.default),r.exports=t,r.exports.default=t;function t(f,u,p){u=u||1;for(var g,x,w,_,M=0;M<f[0].length;M++){var T=f[0][M];(!M||T[0]<g)&&(g=T[0]),(!M||T[1]<x)&&(x=T[1]),(!M||T[0]>w)&&(w=T[0]),(!M||T[1]>_)&&(_=T[1])}var d=w-g,m=_-x,y=Math.min(d,m),z=y/2;if(y===0){var k=[g,x];return k.distance=0,k}for(var b=new i(void 0,n),C=g;C<w;C+=y)for(var B=x;B<_;B+=y)b.push(new s(C+z,B+z,z,f));var D=o(f),X=new s(g+d/2,x+m/2,0,f);X.d>D.d&&(D=X);for(var I=b.length;b.length;){var P=b.pop();P.d>D.d&&(D=P,p&&console.log("found best %d after %d probes",Math.round(1e4*P.d)/1e4,I)),!(P.max-D.d<=u)&&(z=P.h/2,b.push(new s(P.x-z,P.y-z,z,f)),b.push(new s(P.x+z,P.y-z,z,f)),b.push(new s(P.x-z,P.y+z,z,f)),b.push(new s(P.x+z,P.y+z,z,f)),I+=4)}p&&(console.log("num probes: "+I),console.log("best distance: "+D.d));var l=[D.x,D.y];return l.distance=D.d,l}function n(f,u){return u.max-f.max}function s(f,u,p,g){this.x=f,this.y=u,this.h=p,this.d=a(f,u,g),this.max=this.d+this.h*Math.SQRT2}function a(f,u,p){for(var g=!1,x=1/0,w=0;w<p.length;w++)for(var _=p[w],M=0,T=_.length,d=T-1;M<T;d=M++){var m=_[M],y=_[d];m[1]>u!=y[1]>u&&f<(y[0]-m[0])*(u-m[1])/(y[1]-m[1])+m[0]&&(g=!g),x=Math.min(x,h(f,u,m,y))}return x===0?0:(g?1:-1)*Math.sqrt(x)}function o(f){for(var u=0,p=0,g=0,x=f[0],w=0,_=x.length,M=_-1;w<_;M=w++){var T=x[w],d=x[M],m=T[0]*d[1]-d[0]*T[1];p+=(T[0]+d[0])*m,g+=(T[1]+d[1])*m,u+=m*3}return u===0?new s(x[0][0],x[0][1],0,f):new s(p/u,g/u,0,f)}function h(f,u,p,g){var x=p[0],w=p[1],_=g[0]-x,M=g[1]-w;if(_!==0||M!==0){var T=((f-x)*_+(u-w)*M)/(_*_+M*M);T>1?(x=g[0],w=g[1]):T>0&&(x+=_*T,w+=M*T)}return _=f-x,M=u-w,_*_+M*M}}}),vs=W(ie()),le=W(ie()),we=W(ie()),Or=W(Pr()),jr=W(Xr()),q=(e,r,i)=>new Promise((t,n)=>{var s=h=>{try{o(i.next(h))}catch(f){n(f)}},a=h=>{try{o(i.throw(h))}catch(f){n(f)}},o=h=>h.done?t(h.value):Promise.resolve(h.value).then(s,a);o((i=i.apply(e,r)).next())}),N=Uint8Array,ae=Uint16Array,Dt=Uint32Array,Pt=new N([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Et=new N([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Ur=new N([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Xt=function(e,r){for(var i=new ae(31),t=0;t<31;++t)i[t]=r+=1<<e[t-1];for(var n=new Dt(i[30]),t=1;t<30;++t)for(var s=i[t];s<i[t+1];++s)n[s]=s-i[t]<<5|t;return[i,n]},Yt=Xt(Pt,2),Vt=Yt[0],qr=Yt[1];Vt[28]=258,qr[258]=28;var It=Xt(Et,0),Rr=It[0],xs=It[1],Ue=new ae(32768);for(V=0;V<32768;++V)re=(V&43690)>>>1|(V&21845)<<1,re=(re&52428)>>>2|(re&13107)<<2,re=(re&61680)>>>4|(re&3855)<<4,Ue[V]=((re&65280)>>>8|(re&255)<<8)>>>1;var re,V,ve=function(e,r,i){for(var t=e.length,n=0,s=new ae(r);n<t;++n)e[n]&&++s[e[n]-1];var a=new ae(r);for(n=0;n<r;++n)a[n]=a[n-1]+s[n-1]<<1;var o;if(i){o=new ae(1<<r);var h=15-r;for(n=0;n<t;++n)if(e[n])for(var f=n<<4|e[n],u=r-e[n],p=a[e[n]-1]++<<u,g=p|(1<<u)-1;p<=g;++p)o[Ue[p]>>>h]=f}else for(o=new ae(t),n=0;n<t;++n)e[n]&&(o[n]=Ue[a[e[n]-1]++]>>>15-e[n]);return o},be=new N(288);for(V=0;V<144;++V)be[V]=8;var V;for(V=144;V<256;++V)be[V]=9;var V;for(V=256;V<280;++V)be[V]=7;var V;for(V=280;V<288;++V)be[V]=8;var V,At=new N(32);for(V=0;V<32;++V)At[V]=5;var V,Nr=ve(be,9,1),Wr=ve(At,5,1),Ae=function(e){for(var r=e[0],i=1;i<e.length;++i)e[i]>r&&(r=e[i]);return r},$=function(e,r,i){var t=r/8|0;return(e[t]|e[t+1]<<8)>>(r&7)&i},Oe=function(e,r){var i=r/8|0;return(e[i]|e[i+1]<<8|e[i+2]<<16)>>(r&7)},$r=function(e){return(e+7)/8|0},Zr=function(e,r,i){(r==null||r<0)&&(r=0),(i==null||i>e.length)&&(i=e.length);var t=new(e.BYTES_PER_ELEMENT==2?ae:e.BYTES_PER_ELEMENT==4?Dt:N)(i-r);return t.set(e.subarray(r,i)),t},Hr=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],H=function(e,r,i){var t=new Error(r||Hr[e]);if(t.code=e,Error.captureStackTrace&&Error.captureStackTrace(t,H),!i)throw t;return t},We=function(e,r,i){var t=e.length;if(!t||i&&i.f&&!i.l)return r||new N(0);var n=!r||i,s=!i||i.i;i||(i={}),r||(r=new N(t*3));var a=function(et){var tt=r.length;if(et>tt){var rt=new N(Math.max(tt*2,et));rt.set(r),r=rt}},o=i.f||0,h=i.p||0,f=i.b||0,u=i.l,p=i.d,g=i.m,x=i.n,w=t*8;do{if(!u){o=$(e,h,1);var _=$(e,h+1,3);if(h+=3,_)if(_==1)u=Nr,p=Wr,g=9,x=5;else if(_==2){var m=$(e,h,31)+257,y=$(e,h+10,15)+4,z=m+$(e,h+5,31)+1;h+=14;for(var k=new N(z),b=new N(19),C=0;C<y;++C)b[Ur[C]]=$(e,h+C*3,7);h+=y*3;for(var B=Ae(b),D=(1<<B)-1,X=ve(b,B,1),C=0;C<z;){var I=X[$(e,h,D)];h+=I&15;var M=I>>>4;if(M<16)k[C++]=M;else{var P=0,l=0;for(M==16?(l=3+$(e,h,3),h+=2,P=k[C-1]):M==17?(l=3+$(e,h,7),h+=3):M==18&&(l=11+$(e,h,127),h+=7);l--;)k[C++]=P}}var c=k.subarray(0,m),v=k.subarray(m);g=Ae(c),x=Ae(v),u=ve(c,g,1),p=ve(v,x,1)}else H(1);else{var M=$r(h)+4,T=e[M-4]|e[M-3]<<8,d=M+T;if(d>t){s&&H(0);break}n&&a(f+T),r.set(e.subarray(M,d),f),i.b=f+=T,i.p=h=d*8,i.f=o;continue}if(h>w){s&&H(0);break}}n&&a(f+131072);for(var F=(1<<g)-1,S=(1<<x)-1,E=h;;E=h){var P=u[Oe(e,h)&F],Y=P>>>4;if(h+=P&15,h>w){s&&H(0);break}if(P||H(2),Y<256)r[f++]=Y;else if(Y==256){E=h,u=null;break}else{var j=Y-254;if(Y>264){var C=Y-257,A=Pt[C];j=$(e,h,(1<<A)-1)+Vt[C],h+=A}var Q=p[Oe(e,h)&S],se=Q>>>4;Q||H(3),h+=Q&15;var v=Rr[se];if(se>3){var A=Et[se];v+=Oe(e,h)&(1<<A)-1,h+=A}if(h>w){s&&H(0);break}n&&a(f+131072);for(var Qe=f+j;f<Qe;f+=4)r[f]=r[f-v],r[f+1]=r[f+1-v],r[f+2]=r[f+2-v],r[f+3]=r[f+3-v];f=Qe}}i.l=u,i.p=E,i.b=f,i.f=o,u&&(o=1,i.m=g,i.d=p,i.n=x)}while(!o);return f==r.length?r:Zr(r,0,f)},Kr=new N(0),Gr=function(e){(e[0]!=31||e[1]!=139||e[2]!=8)&&H(6,"invalid gzip data");var r=e[3],i=10;r&4&&(i+=e[10]|(e[11]<<8)+2);for(var t=(r>>3&1)+(r>>4&1);t>0;t-=!e[i++]);return i+(r&2)},Jr=function(e){var r=e.length;return(e[r-4]|e[r-3]<<8|e[r-2]<<16|e[r-1]<<24)>>>0},Qr=function(e){((e[0]&15)!=8||e[0]>>>4>7||(e[0]<<8|e[1])%31)&&H(6,"invalid zlib data"),e[1]&32&&H(6,"invalid zlib data: preset dictionaries not supported")};function ei(e,r){return We(e,r)}function ti(e,r){return We(e.subarray(Gr(e),-8),r||new N(Jr(e)))}function ri(e,r){return We((Qr(e),e.subarray(2,-4)),r)}function qe(e,r){return e[0]==31&&e[1]==139&&e[2]==8?ti(e,r):(e[0]&15)!=8||e[0]>>4>7||(e[0]<<8|e[1])%31?ei(e,r):ri(e,r)}var ii=typeof TextDecoder<"u"&&new TextDecoder,ni=0;try{ii.decode(Kr,{stream:!0}),ni=1}catch{}var Ot=(e,r)=>e*Math.pow(2,r),pe=(e,r)=>Math.floor(e/Math.pow(2,r)),Fe=(e,r)=>Ot(e.getUint16(r+1,!0),8)+e.getUint8(r),jt=(e,r)=>Ot(e.getUint32(r+2,!0),16)+e.getUint16(r,!0),si=(e,r,i,t,n)=>{if(e!=t.getUint8(n))return e-t.getUint8(n);let s=Fe(t,n+1);if(r!=s)return r-s;let a=Fe(t,n+4);return i!=a?i-a:0},ai=(e,r,i,t)=>{let n=Ut(e,r|128,i,t);return n?{z:r,x:i,y:t,offset:n[0],length:n[1],is_dir:!0}:null},lt=(e,r,i,t)=>{let n=Ut(e,r,i,t);return n?{z:r,x:i,y:t,offset:n[0],length:n[1],is_dir:!1}:null},Ut=(e,r,i,t)=>{let n=0,s=e.byteLength/17-1;for(;n<=s;){let a=s+n>>1,o=si(r,i,t,e,a*17);if(o>0)n=a+1;else if(o<0)s=a-1;else return[jt(e,a*17+7),e.getUint32(a*17+13,!0)]}return null},oi=(e,r)=>e.is_dir&&!r.is_dir?1:!e.is_dir&&r.is_dir?-1:e.z!==r.z?e.z-r.z:e.x!==r.x?e.x-r.x:e.y-r.y,qt=(e,r)=>{let i=e.getUint8(r*17);return{z:i&127,x:Fe(e,r*17+1),y:Fe(e,r*17+4),offset:jt(e,r*17+7),length:e.getUint32(r*17+13,!0),is_dir:i>>7===1}},ht=e=>{let r=[],i=new DataView(e);for(let t=0;t<i.byteLength/17;t++)r.push(qt(i,t));return li(r)},li=e=>{e.sort(oi);let r=new ArrayBuffer(17*e.length),i=new Uint8Array(r);for(let t=0;t<e.length;t++){let n=e[t],s=n.z;n.is_dir&&(s=s|128),i[t*17]=s,i[t*17+1]=n.x&255,i[t*17+2]=n.x>>8&255,i[t*17+3]=n.x>>16&255,i[t*17+4]=n.y&255,i[t*17+5]=n.y>>8&255,i[t*17+6]=n.y>>16&255,i[t*17+7]=n.offset&255,i[t*17+8]=pe(n.offset,8)&255,i[t*17+9]=pe(n.offset,16)&255,i[t*17+10]=pe(n.offset,24)&255,i[t*17+11]=pe(n.offset,32)&255,i[t*17+12]=pe(n.offset,48)&255,i[t*17+13]=n.length&255,i[t*17+14]=n.length>>8&255,i[t*17+15]=n.length>>16&255,i[t*17+16]=n.length>>24&255}return r},hi=(e,r)=>{if(e.byteLength<17)return null;let i=e.byteLength/17,t=qt(e,i-1);if(t.is_dir){let n=t.z,s=r.z-n,a=Math.trunc(r.x/(1<<s)),o=Math.trunc(r.y/(1<<s));return{z:n,x:a,y:o}}return null};function fi(e){return q(this,null,function*(){let r=yield e.getBytes(0,512e3),i=new DataView(r.data),t=i.getUint32(4,!0),n=i.getUint16(8,!0),s=new TextDecoder("utf-8"),a=JSON.parse(s.decode(new DataView(r.data,10,t))),o=0;a.compression==="gzip"&&(o=2);let h=0;"minzoom"in a&&(h=+a.minzoom);let f=0;"maxzoom"in a&&(f=+a.maxzoom);let u=0,p=0,g=0,x=-180,w=-85,_=180,M=85;if(a.bounds){let d=a.bounds.split(",");x=+d[0],w=+d[1],_=+d[2],M=+d[3]}if(a.center){let d=a.center.split(",");u=+d[0],p=+d[1],g=+d[2]}return{specVersion:i.getUint16(2,!0),rootDirectoryOffset:10+t,rootDirectoryLength:n*17,jsonMetadataOffset:10,jsonMetadataLength:t,leafDirectoryOffset:0,leafDirectoryLength:void 0,tileDataOffset:0,tileDataLength:void 0,numAddressedTiles:0,numTileEntries:0,numTileContents:0,clustered:!1,internalCompression:1,tileCompression:o,tileType:1,minZoom:h,maxZoom:f,minLon:x,minLat:w,maxLon:_,maxLat:M,centerZoom:g,centerLon:u,centerLat:p,etag:r.etag}})}function ui(e,r,i,t,n,s,a){return q(this,null,function*(){let o=yield i.getArrayBuffer(r,e.rootDirectoryOffset,e.rootDirectoryLength,e);e.specVersion===1&&(o=ht(o));let h=lt(new DataView(o),t,n,s);if(h){let p=(yield r.getBytes(h.offset,h.length,a)).data,g=new DataView(p);return g.getUint8(0)==31&&g.getUint8(1)==139&&(p=qe(new Uint8Array(p))),{data:p}}let f=hi(new DataView(o),{z:t,x:n,y:s});if(f){let u=ai(new DataView(o),f.z,f.x,f.y);if(u){let p=yield i.getArrayBuffer(r,u.offset,u.length,e);e.specVersion===1&&(p=ht(p));let g=lt(new DataView(p),t,n,s);if(g){let w=(yield r.getBytes(g.offset,g.length,a)).data,_=new DataView(w);return _.getUint8(0)==31&&_.getUint8(1)==139&&(w=qe(new Uint8Array(w))),{data:w}}}}})}var Rt={getHeader:fi,getZxy:ui};function he(e,r){return(r>>>0)*4294967296+(e>>>0)}function di(e,r){let i=r.buf,t,n;if(n=i[r.pos++],t=(n&112)>>4,n<128||(n=i[r.pos++],t|=(n&127)<<3,n<128)||(n=i[r.pos++],t|=(n&127)<<10,n<128)||(n=i[r.pos++],t|=(n&127)<<17,n<128)||(n=i[r.pos++],t|=(n&127)<<24,n<128)||(n=i[r.pos++],t|=(n&1)<<31,n<128))return he(e,t);throw new Error("Expected varint not more than 10 bytes")}function me(e){let r=e.buf,i,t;return t=r[e.pos++],i=t&127,t<128||(t=r[e.pos++],i|=(t&127)<<7,t<128)||(t=r[e.pos++],i|=(t&127)<<14,t<128)||(t=r[e.pos++],i|=(t&127)<<21,t<128)?i:(t=r[e.pos],i|=(t&15)<<28,di(i,e))}function ci(e,r,i,t){if(t==0){i==1&&(r[0]=e-1-r[0],r[1]=e-1-r[1]);let n=r[0];r[0]=r[1],r[1]=n}}function pi(e,r,i){if(e>26)throw Error("Tile zoom level exceeds max safe number limit (26)");if(r>Math.pow(2,e)-1||i>Math.pow(2,e)-1)throw Error("tile x/y outside zoom level bounds");let t=0,n=0;for(;n<e;)t+=Math.pow(2,n)*Math.pow(2,n),n++;let s=Math.pow(2,e),a=0,o=0,h=0,f=[r,i],u=s/2;for(;u>0;)a=(f[0]&u)>0?1:0,o=(f[1]&u)>0?1:0,h+=u*u*(3*a^o),ci(u,f,a,o),u=u/2;return t+h}function Nt(e,r){return q(this,null,function*(){if(r===1||r===0)return e;if(r===2)return qe(new Uint8Array(e));throw Error("Compression method not supported")})}var mi=127;function yi(e,r){let i=0,t=e.length-1;for(;i<=t;){let n=t+i>>1,s=r-e[n].tileId;if(s>0)i=n+1;else if(s<0)t=n-1;else return e[n]}return t>=0&&(e[t].runLength===0||r-e[t].tileId<e[t].runLength)?e[t]:null}var gi=class{constructor(e){this.url=e}getKey(){return this.url}getBytes(e,r,i){return q(this,null,function*(){let t;i||(t=new AbortController,i=t.signal);let n=yield fetch(this.url,{signal:i,headers:{Range:"bytes="+e+"-"+(e+r-1)}});if(n.status===416&&e===0){let o=n.headers.get("Content-Range");if(!o||!o.startsWith("bytes */"))throw Error("Missing content-length on 416 response");let h=+o.substr(8);n=yield fetch(this.url,{signal:i,headers:{Range:"bytes=0-"+(h-1)}})}if(n.status>=300)throw Error("Bad response code: "+n.status);let s=n.headers.get("Content-Length");if(n.status===200&&(!s||+s>r))throw t&&t.abort(),Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield n.arrayBuffer(),etag:n.headers.get("ETag")||void 0,cacheControl:n.headers.get("Cache-Control")||void 0,expires:n.headers.get("Expires")||void 0}})}};function Z(e,r){let i=e.getUint32(r+4,!0),t=e.getUint32(r+0,!0);return i*Math.pow(2,32)+t}function vi(e,r){let i=new DataView(e),t=i.getUint8(7);if(t>3)throw Error(`Archive is spec version ${t} but this library supports up to spec version 3`);return{specVersion:t,rootDirectoryOffset:Z(i,8),rootDirectoryLength:Z(i,16),jsonMetadataOffset:Z(i,24),jsonMetadataLength:Z(i,32),leafDirectoryOffset:Z(i,40),leafDirectoryLength:Z(i,48),tileDataOffset:Z(i,56),tileDataLength:Z(i,64),numAddressedTiles:Z(i,72),numTileEntries:Z(i,80),numTileContents:Z(i,88),clustered:i.getUint8(96)===1,internalCompression:i.getUint8(97),tileCompression:i.getUint8(98),tileType:i.getUint8(99),minZoom:i.getUint8(100),maxZoom:i.getUint8(101),minLon:i.getInt32(102,!0)/1e7,minLat:i.getInt32(106,!0)/1e7,maxLon:i.getInt32(110,!0)/1e7,maxLat:i.getInt32(114,!0)/1e7,centerZoom:i.getUint8(118),centerLon:i.getInt32(119,!0)/1e7,centerLat:i.getInt32(123,!0)/1e7,etag:r}}function Wt(e){let r={buf:new Uint8Array(e),pos:0},i=me(r),t=[],n=0;for(let s=0;s<i;s++){let a=me(r);t.push({tileId:n+a,offset:0,length:0,runLength:1}),n+=a}for(let s=0;s<i;s++)t[s].runLength=me(r);for(let s=0;s<i;s++)t[s].length=me(r);for(let s=0;s<i;s++){let a=me(r);a===0&&s>0?t[s].offset=t[s-1].offset+t[s-1].length:t[s].offset=a-1}return t}function xi(e){let r=new DataView(e);return r.getUint16(2,!0)===2?(console.warn("PMTiles spec version 2 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),2):r.getUint16(2,!0)===1?(console.warn("PMTiles spec version 1 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),1):3}var fe=class extends Error{};function wi(e,r,i,t){return q(this,null,function*(){let n=yield e.getBytes(0,16384);if(new DataView(n.data).getUint16(0,!0)!==19792)throw new Error("Wrong magic number for PMTiles archive");if(xi(n.data)<3)return[yield Rt.getHeader(e)];let a=n.data.slice(0,mi),o=n.etag;t&&n.etag!=t&&(console.warn("ETag conflict detected; your HTTP server might not support content-based ETag headers. ETags disabled for "+e.getKey()),o=void 0);let h=vi(a,o);if(i){let f=n.data.slice(h.rootDirectoryOffset,h.rootDirectoryOffset+h.rootDirectoryLength),u=e.getKey()+"|"+(h.etag||"")+"|"+h.rootDirectoryOffset+"|"+h.rootDirectoryLength,p=Wt(yield r(f,h.internalCompression));return[h,[u,p.length,p]]}return[h,void 0]})}function _i(e,r,i,t,n){return q(this,null,function*(){let s=yield e.getBytes(i,t);if(n.etag&&n.etag!==s.etag)throw new fe(s.etag);let a=yield r(s.data,n.internalCompression),o=Wt(a);if(o.length===0)throw new Error("Empty directory is invalid");return o})}var bi=class{constructor(e=100,r=!0,i=Nt){this.cache=new Map,this.maxCacheEntries=e,this.counter=1,this.prefetch=r,this.decompress=i}getHeader(e,r){return q(this,null,function*(){let i=e.getKey();if(this.cache.has(i))return this.cache.get(i).lastUsed=this.counter++,yield this.cache.get(i).data;let t=new Promise((n,s)=>{wi(e,this.decompress,this.prefetch,r).then(a=>{a[1]&&this.cache.set(a[1][0],{lastUsed:this.counter++,data:Promise.resolve(a[1][2])}),n(a[0]),this.prune()}).catch(a=>{s(a)})});return this.cache.set(i,{lastUsed:this.counter++,data:t}),t})}getDirectory(e,r,i,t){return q(this,null,function*(){let n=e.getKey()+"|"+(t.etag||"")+"|"+r+"|"+i;if(this.cache.has(n))return this.cache.get(n).lastUsed=this.counter++,yield this.cache.get(n).data;let s=new Promise((a,o)=>{_i(e,this.decompress,r,i,t).then(h=>{a(h),this.prune()}).catch(h=>{o(h)})});return this.cache.set(n,{lastUsed:this.counter++,data:s}),s})}getArrayBuffer(e,r,i,t){return q(this,null,function*(){let n=e.getKey()+"|"+(t.etag||"")+"|"+r+"|"+i;if(this.cache.has(n))return this.cache.get(n).lastUsed=this.counter++,yield this.cache.get(n).data;let s=new Promise((a,o)=>{e.getBytes(r,i).then(h=>{if(t.etag&&t.etag!==h.etag)throw new fe(h.etag);a(h.data),this.cache.has(n),this.prune()}).catch(h=>{o(h)})});return this.cache.set(n,{lastUsed:this.counter++,data:s}),s})}prune(){if(this.cache.size>=this.maxCacheEntries){let e=1/0,r;this.cache.forEach((i,t)=>{i.lastUsed<e&&(e=i.lastUsed,r=t)}),r&&this.cache.delete(r)}}invalidate(e,r){return q(this,null,function*(){this.cache.delete(e.getKey()),yield this.getHeader(e,r)})}},zi=class{constructor(e,r,i){typeof e=="string"?this.source=new gi(e):this.source=e,i?this.decompress=i:this.decompress=Nt,r?this.cache=r:this.cache=new bi}getHeader(){return q(this,null,function*(){return yield this.cache.getHeader(this.source)})}getZxyAttempt(e,r,i,t){return q(this,null,function*(){let n=pi(e,r,i),s=yield this.cache.getHeader(this.source);if(s.specVersion<3)return Rt.getZxy(s,this.source,this.cache,e,r,i,t);if(e<s.minZoom||e>s.maxZoom)return;let a=s.rootDirectoryOffset,o=s.rootDirectoryLength;for(let h=0;h<=3;h++){let f=yield this.cache.getDirectory(this.source,a,o,s),u=yi(f,n);if(u)if(u.runLength>0){let p=yield this.source.getBytes(s.tileDataOffset+u.offset,u.length,t);if(s.etag&&s.etag!==p.etag)throw new fe(p.etag);return{data:yield this.decompress(p.data,s.tileCompression),cacheControl:p.cacheControl,expires:p.expires}}else a=s.leafDirectoryOffset+u.offset,o=u.length;else return}throw Error("Maximum directory depth exceeded")})}getZxy(e,r,i,t){return q(this,null,function*(){try{return yield this.getZxyAttempt(e,r,i,t)}catch(n){if(n instanceof fe)return this.cache.invalidate(this.source,n.message),yield this.getZxyAttempt(e,r,i,t);throw n}})}getMetadataAttempt(){return q(this,null,function*(){let e=yield this.cache.getHeader(this.source),r=yield this.source.getBytes(e.jsonMetadataOffset,e.jsonMetadataLength);if(e.etag&&e.etag!==r.etag)throw new fe(r.etag);let i=yield this.decompress(r.data,e.internalCompression),t=new TextDecoder("utf-8");return JSON.parse(t.decode(i))})}getMetadata(){return q(this,null,function*(){try{return yield this.getMetadataAttempt()}catch(e){if(e instanceof fe)return this.cache.invalidate(this.source,e.message),yield this.getMetadataAttempt();throw e}})}},ue;(function(e){e[e.Point=1]="Point",e[e.Line=2]="Line",e[e.Polygon=3]="Polygon"})(ue||(ue={}));function oe(e){return e.x+":"+e.y+":"+e.z}var ki=(e,r,i)=>{e.pos=r;for(var t=e.readVarint()+e.pos,n=1,s=0,a=0,o=0,h=1/0,f=-1/0,u=1/0,p=-1/0,g=[],x=[];e.pos<t;){if(s<=0){var w=e.readVarint();n=w&7,s=w>>3}if(s--,n===1||n===2)a+=e.readSVarint()*i,o+=e.readSVarint()*i,a<h&&(h=a),a>f&&(f=a),o<u&&(u=o),o>p&&(p=o),n===1&&(x.length>0&&g.push(x),x=[]),x.push(new we.default(a,o));else if(n===7)x&&x.push(x[0].clone());else throw new Error("unknown command "+n)}return x&&g.push(x),{geom:g,bbox:{minX:h,minY:u,maxX:f,maxY:p}}};function $t(e,r){let i=new Or.VectorTile(new jr.default(e)),t=new Map;for(let[n,s]of Object.entries(i.layers)){let a=[],o=s;for(let h=0;h<o.length;h++){let f=ki(o.feature(h)._pbf,o.feature(h)._geometry,r/o.extent),u=0;for(let p of f.geom)u+=p.length;a.push({id:o.feature(h).id,geomType:o.feature(h).type,geom:f.geom,numVertices:u,bbox:f.bbox,props:o.feature(h).properties})}t.set(n,a)}return t}var ft=class{constructor(e,r){typeof e=="string"?this.p=new zi(e):this.p=e,this.controllers=[],this.shouldCancelZooms=r}get(e,r){return de(this,null,function*(){this.shouldCancelZooms&&(this.controllers=this.controllers.filter(s=>s[0]!=e.z?(s[1].abort(),!1):!0));let i=new AbortController;this.controllers.push([e.z,i]);let t=i.signal,n=yield this.p.getZxy(e.z,e.x,e.y,t);return n?$t(n.data,r):new Map})}},Mi=class{constructor(e,r){this.url=e,this.controllers=[],this.shouldCancelZooms=r}get(e,r){return de(this,null,function*(){this.shouldCancelZooms&&(this.controllers=this.controllers.filter(s=>s[0]!=e.z?(s[1].abort(),!1):!0));let i=this.url.replace("{z}",e.z.toString()).replace("{x}",e.x.toString()).replace("{y}",e.y.toString()),t=new AbortController;this.controllers.push([e.z,t]);let n=t.signal;return new Promise((s,a)=>{fetch(i,{signal:n}).then(o=>o.arrayBuffer()).then(o=>{let h=$t(o,r);s(h)}).catch(o=>{a(o)})})})}},Re=6378137,ut=85.0511287798,Le=Re*Math.PI,Li=e=>{let r=Math.PI/180,i=Math.max(Math.min(ut,e[0]),-ut),t=Math.sin(i*r);return new we.default(Re*e[1]*r,Re*Math.log((1+t)/(1-t))/2)};function dt(e){return e*e}function Se(e,r){return dt(e.x-r.x)+dt(e.y-r.y)}function Ci(e,r,i){var t=Se(r,i);if(t===0)return Se(e,r);var n=((e.x-r.x)*(i.x-r.x)+(e.y-r.y)*(i.y-r.y))/t;return n=Math.max(0,Math.min(1,n)),Se(e,new we.default(r.x+n*(i.x-r.x),r.y+n*(i.y-r.y)))}function ct(e,r){for(var i=!1,t=0,n=r.length-1;t<r.length;n=t++){var s=r[t].x,a=r[t].y,o=r[n].x,h=r[n].y,f=a>e.y!=h>e.y&&e.x<(o-s)*(e.y-a)/(h-a)+s;f&&(i=!i)}return i}function Ti(e){for(var r=0,i=0;i<e.length;i++){let t=(i+1)%e.length;r+=e[i].x*e[t].y,r-=e[t].x*e[i].y}return r<0}function Si(e,r){var i=!1;for(let t of r)if(Ti(t))ct(e,t)&&(i=!1);else{if(i)return!0;ct(e,t)&&(i=!0)}return i}function Fi(e,r){let i=1/0;for(let t of r){let n=Math.sqrt(Se(e,t[0]));n<i&&(i=n)}return i}function Bi(e,r){let i=1/0;for(let n of r)for(var t=0;t<n.length-1;t++){let s=Math.sqrt(Ci(e,n[t],n[t+1]));s<i&&(i=s)}return i}var Di=class{constructor(e,r){this.source=e,this.cache=new Map,this.inflight=new Map,this.tileSize=r}queryFeatures(e,r,i,t){let n=Li([r,e]);var s=new we.default((n.x+Le)/(Le*2),1-(n.y+Le)/(Le*2));s.x>1&&(s.x=s.x-Math.floor(s.x));let a=s.mult(1<<i),o=Math.floor(a.x),h=Math.floor(a.y),f=oe({z:i,x:o,y:h}),u=[],p=this.cache.get(f);if(p){let g=new we.default((a.x-o)*this.tileSize,(a.y-h)*this.tileSize);for(let[x,w]of p.data.entries())for(let _ of w)_.geomType==1?Fi(g,_.geom)<t&&u.push({feature:_,layerName:x}):_.geomType==2?Bi(g,_.geom)<t&&u.push({feature:_,layerName:x}):Si(g,_.geom)&&u.push({feature:_,layerName:x})}return u}get(e){return de(this,null,function*(){let r=oe(e);return new Promise((i,t)=>{let n=this.cache.get(r);if(n)n.used=performance.now(),i(n.data);else{let s=this.inflight.get(r);s?s.push([i,t]):(this.inflight.set(r,[]),this.source.get(e,this.tileSize).then(a=>{this.cache.set(r,{used:performance.now(),data:a});let o=this.inflight.get(r);if(o&&o.forEach(h=>h[0](a)),this.inflight.delete(r),i(a),this.cache.size>=64){let h=1/0,f;this.cache.forEach((u,p)=>{u.used<h&&(h=u.used,f=p)}),f&&this.cache.delete(f)}}).catch(a=>{let o=this.inflight.get(r);o&&o.forEach(h=>h[1](a)),this.inflight.delete(r),t(a)}))}})})}},Zt=(e,r,i)=>{let t=[];for(let n of e){let s=[];for(let a of n)s.push(a.clone().mult(r).add(i));t.push(s)}return t},Ce=(e,r)=>{let i=1<<r;return e<0&&(e=i+e),e>=i&&(e=e%i),e},Pi=class{constructor(e,r,i){this.tileCache=e,this.maxDataLevel=r,this.levelDiff=i}dataTilesForBounds(e,r){let i=Math.pow(2,e)/Math.pow(2,Math.ceil(e)),t=[];var n=1,s=this.tileCache.tileSize;if(e<this.levelDiff)n=1/(1<<this.levelDiff-e)*i,t.push({data_tile:{z:0,x:0,y:0},origin:new le.default(0,0),scale:n,dim:s*n});else if(e<=this.levelDiff+this.maxDataLevel){let h=1<<this.levelDiff,f=256*i,u=Math.ceil(e)-this.levelDiff,p=Math.floor(r.minX/h/f),g=Math.floor(r.minY/h/f),x=Math.floor(r.maxX/h/f),w=Math.floor(r.maxY/h/f);for(var a=p;a<=x;a++)for(var o=g;o<=w;o++){let _=new le.default(a*h*f,o*h*f);t.push({data_tile:{z:u,x:Ce(a,u),y:Ce(o,u)},origin:_,scale:i,dim:s*i})}}else{let h=1<<this.levelDiff;n=(1<<Math.ceil(e)-this.maxDataLevel-this.levelDiff)*i;let f=Math.floor(r.minX/h/256/n),u=Math.floor(r.minY/h/256/n),p=Math.floor(r.maxX/h/256/n),g=Math.floor(r.maxY/h/256/n);for(var a=f;a<=p;a++)for(var o=u;o<=g;o++){let _=new le.default(a*h*256*n,o*h*256*n);t.push({data_tile:{z:this.maxDataLevel,x:Ce(a,this.maxDataLevel),y:Ce(o,this.maxDataLevel)},origin:_,scale:n,dim:s*n})}}return t}dataTileForDisplayTile(e){var r,i=1,t=this.tileCache.tileSize,n;if(e.z<this.levelDiff)r={z:0,x:0,y:0},i=1/(1<<this.levelDiff-e.z),n=new le.default(0,0),t=t*i;else if(e.z<=this.levelDiff+this.maxDataLevel){let s=1<<this.levelDiff;r={z:e.z-this.levelDiff,x:Math.floor(e.x/s),y:Math.floor(e.y/s)},n=new le.default(r.x*s*256,r.y*s*256)}else{i=1<<e.z-this.maxDataLevel-this.levelDiff;let s=1<<this.levelDiff;r={z:this.maxDataLevel,x:Math.floor(e.x/s/i),y:Math.floor(e.y/s/i)},n=new le.default(r.x*s*i*256,r.y*s*i*256),t=t*i}return{data_tile:r,scale:i,origin:n,dim:t}}getBbox(e,r){return de(this,null,function*(){let i=this.dataTilesForBounds(e,r);return(yield Promise.all(i.map(n=>this.tileCache.get(n.data_tile)))).map((n,s)=>{let a=i[s];return{data:n,z:e,data_tile:a.data_tile,scale:a.scale,dim:a.dim,origin:a.origin}})})}getDisplayTile(e){return de(this,null,function*(){let r=this.dataTileForDisplayTile(e);return{data:yield this.tileCache.get(r.data_tile),z:e.z,data_tile:r.data_tile,scale:r.scale,origin:r.origin,dim:r.dim}})}queryFeatures(e,r,i){let t=Math.round(i),n=Math.min(t-this.levelDiff,this.maxDataLevel),s=16/(1<<t-n);return this.tileCache.queryFeatures(e,r,n,s)}},Ei=e=>{let r=t=>{let n=t.levelDiff===void 0?2:t.levelDiff,s=t.maxDataZoom||14,a;typeof t.url=="string"?t.url.endsWith(".pmtiles")?a=new ft(t.url,!0):a=new Mi(t.url,!0):a=new ft(t.url,!0);let o=new Di(a,256*1<<n);return new Pi(o,s,n)},i=new Map;if(e.sources)for(let t in e.sources)i.set(t,r(e.sources[t]));else i.set("",r(e));return i},Xi=W(ie());function Yi(e,r,i,t,n,s,a,o,h){let f=performance.now();e.save(),e.miterLimit=2;for(var u of n){if(u.minzoom&&r<u.minzoom||u.maxzoom&&r>u.maxzoom)continue;let w=i.get(u.dataSource||"");if(w)for(let _ of w){var p=_.data.get(u.dataLayer);if(p===void 0)continue;u.symbolizer.before&&u.symbolizer.before(e,_.z);let M=_.origin,T=_.dim,d=_.scale;if(e.save(),o){e.beginPath();let m=Math.max(M.x-a.x,s.minX-a.x),y=Math.max(M.y-a.y,s.minY-a.y),z=Math.min(M.x-a.x+T,s.maxX-a.x),k=Math.min(M.y-a.y+T,s.maxY-a.y);e.rect(m,y,z-m,k-y),e.clip()}e.translate(M.x-a.x,M.y-a.y);for(var g of p){let m=g.geom,y=g.bbox;y.maxX*d+M.x<s.minX||y.minX*d+M.x>s.maxX||y.minY*d+M.y>s.maxY||y.maxY*d+M.y<s.minY||u.filter&&!u.filter(_.z,g)||(d!=1&&(m=Zt(m,d,new Xi.default(0,0))),u.symbolizer.draw(e,m,_.z,g))}e.restore()}}if(o&&(e.beginPath(),e.rect(s.minX-a.x,s.minY-a.y,s.maxX-s.minX,s.maxY-s.minY),e.clip()),t){let w=t.searchBbox(s,1/0);for(var x of w)if(e.save(),e.translate(x.anchor.x-a.x,x.anchor.y-a.y),x.draw(e),e.restore(),h){e.lineWidth=.5,e.strokeStyle=h,e.fillStyle=h,e.globalAlpha=1,e.fillRect(x.anchor.x-a.x-2,x.anchor.y-a.y-2,4,4);for(let _ of x.bboxes)e.strokeRect(_.minX-a.x,_.minY-a.y,_.maxX-_.minX,_.maxY-_.minY)}}return e.restore(),performance.now()-f}var Vi=W(ie()),Ii=W(Yr()),Ai=(e,r,i)=>{let t=256,n=r/t,s=Math.floor(i.minX/t),a=Math.floor(i.minY/t),o=Math.floor(i.maxX/t),h=Math.floor(i.maxY/t),f=Math.log2(n),u=[];for(let p=s;p<=o;p++){let g=p%(1<<e);for(let x=a;x<=h;x++)u.push({display:oe({z:e,x:g,y:x}),key:oe({z:e-f,x:Math.floor(g/n),y:Math.floor(x/n)})})}return u},Oi=class{constructor(e,r){this.tree=new Ii.default,this.current=new Map,this.dim=e,this.maxLabeledTiles=r}hasPrefix(e){for(let r of this.current.keys())if(r.startsWith(e))return!0;return!1}has(e){return this.current.has(e)}size(){return this.current.size}keys(){return this.current.keys()}searchBbox(e,r){let i=new Set;for(let t of this.tree.search(e))t.indexed_label.order<=r&&i.add(t.indexed_label);return i}searchLabel(e,r){let i=new Set;for(let t of e.bboxes)for(let n of this.tree.search(t))n.indexed_label.order<=r&&i.add(n.indexed_label);return i}bboxCollides(e,r){for(let i of this.tree.search(e))if(i.indexed_label.order<=r)return!0;return!1}labelCollides(e,r){for(let i of e.bboxes)for(let t of this.tree.search(i))if(t.indexed_label.order<=r)return!0;return!1}deduplicationCollides(e){if(!e.deduplicationKey||!e.deduplicationDistance)return!1;let r=e.deduplicationDistance,i={minX:e.anchor.x-r,minY:e.anchor.y-r,maxX:e.anchor.x+r,maxY:e.anchor.y+r};for(let t of this.tree.search(i))if(t.indexed_label.deduplicationKey===e.deduplicationKey&&t.indexed_label.anchor.dist(e.anchor)<r)return!0;return!1}makeEntry(e){this.current.get(e)&&console.log("consistency error 1");let r=new Set;this.current.set(e,r)}insert(e,r,i){let t={anchor:e.anchor,bboxes:e.bboxes,draw:e.draw,order:r,tileKey:i,deduplicationKey:e.deduplicationKey,deduplicationDistance:e.deduplicationDistance},n=this.current.get(i);if(!n){let u=new Set;this.current.set(i,u),n=u}n.add(t);var s=!1,a=!1;for(let u of e.bboxes){var o=u;o.indexed_label=t,this.tree.insert(o),u.minX<0&&(s=!0),u.maxX>this.dim&&(a=!0)}if(s||a){var h=s?this.dim:-this.dim,f=[];for(let g of e.bboxes)f.push({minX:g.minX+h,minY:g.minY,maxX:g.maxX+h,maxY:g.maxY});let u={anchor:new Vi.default(e.anchor.x+h,e.anchor.y),bboxes:f,draw:e.draw,order:r,tileKey:i},p=this.current.get(i);p&&p.add(u);for(let g of f){var o=g;o.indexed_label=u,this.tree.insert(o)}}}pruneOrNoop(e){let r=e.split(":"),i,t=0,n=0;for(var s of this.current.keys()){let a=s.split(":");if(a[3]===r[3]){n++;let o=Math.sqrt(Math.pow(+a[0]-+r[0],2)+Math.pow(+a[1]-+r[1],2));o>t&&(t=o,i=s)}i&&n>this.maxLabeledTiles&&this.pruneKey(i)}}pruneKey(e){let r=this.current.get(e);if(!r)return;let i=[];for(let t of this.tree.all())r.has(t.indexed_label)&&i.push(t);i.forEach(t=>{this.tree.remove(t)}),this.current.delete(e)}removeLabel(e){let r=[];for(let t of this.tree.all())e==t.indexed_label&&r.push(t);r.forEach(t=>{this.tree.remove(t)});let i=this.current.get(e.tileKey);i&&i.delete(e)}},ji=class{constructor(e,r,i,t,n){this.index=new Oi(256*1<<e,t),this.z=e,this.scratch=r,this.labelRules=i,this.callback=n}layout(e){let r=performance.now(),i=new Set;for(let[a,o]of e)for(let h of o){let f=oe(h.data_tile)+":"+a;this.index.has(f)||(this.index.makeEntry(f),i.add(f))}let t=new Set;for(let[a,o]of this.labelRules.entries()){if(o.visible==!1||o.minzoom&&this.z<o.minzoom||o.maxzoom&&this.z>o.maxzoom)continue;let h=o.dataSource||"",f=e.get(h);if(f)for(let u of f){let p=oe(u.data_tile)+":"+h;if(!i.has(p))continue;let g=u.data.get(o.dataLayer);if(g===void 0)continue;let x=g;o.sort&&x.sort((_,M)=>o.sort?o.sort(_.props,M.props):0);let w={index:this.index,zoom:this.z,scratch:this.scratch,order:a,overzoom:this.z-u.data_tile.z};for(let _ of x){if(o.filter&&!o.filter(this.z,_))continue;let M=Zt(_.geom,u.scale,u.origin),T=o.symbolizer.place(w,M,_);if(T)for(let d of T){var n=!1;if(!(d.deduplicationKey&&this.index.deduplicationCollides(d))){if(this.index.labelCollides(d,1/0)){if(!this.index.labelCollides(d,a)){let m=this.index.searchLabel(d,1/0);for(let y of m){this.index.removeLabel(y);for(let z of y.bboxes)this.findInvalidatedTiles(t,u.dim,z,p)}this.index.insert(d,a,p),n=!0}}else this.index.insert(d,a,p),n=!0;if(n)for(let m of d.bboxes)(m.maxX>u.origin.x+u.dim||m.minX<u.origin.x||m.minY<u.origin.y||m.maxY>u.origin.y+u.dim)&&this.findInvalidatedTiles(t,u.dim,m,p)}}}}}for(var s of i)this.index.pruneOrNoop(s);return t.size>0&&this.callback&&this.callback(t),performance.now()-r}findInvalidatedTiles(e,r,i,t){let n=Ai(this.z,r,i);for(let s of n)s.key!=t&&this.index.hasPrefix(s.key)&&e.add(s.display)}add(e){var r=!0;for(let[i,t]of e)for(let n of t)this.index.has(oe(n.data_tile)+":"+i)||(r=!1);return r?0:this.layout(e)}},pt=class{constructor(e,r,i,t){this.labelers=new Map,this.scratch=e,this.labelRules=r,this.maxLabeledTiles=i,this.callback=t}add(e,r){var i=this.labelers.get(e);return i||(i=new ji(e,this.scratch,this.labelRules,this.maxLabeledTiles,this.callback),this.labelers.set(e,i)),i.add(r)}getIndex(e){let r=this.labelers.get(e);if(r)return r.index}},mt={earth:"#FFFBF6",glacier:"#ffffff",residential:"#F4F4F8",hospital:"#FFF6F6",cemetery:"#EFF2EE",school:"#F7F6FF",industrial:"#FFF9EF",wood:"#F4F9EF",grass:"#EBF9E3",park:"#E5F9D5",water:"#B7DFF2",sand:"#ebebeb",buildings:"#F2EDE8",highwayCasing:"#FFC3C3",majorRoadCasing:"#FFB9B9",mediumRoadCasing:"#FFCE8E",minorRoadCasing:"#cccccc",highway:"#FFCEBB",majorRoad:"#FFE4B3",mediumRoad:"#FFF2C8",minorRoad:"#ffffff",boundaries:"#9e9e9e",mask:"#dddddd",countryLabel:"#aaaaaa",cityLabel:"#6C6C6C",stateLabel:"#999999",neighbourhoodLabel:"#888888",landuseLabel:"#898989",waterLabel:"#41ABDC",naturalLabel:"#4B8F14",roadsLabel:"#888888",poisLabel:"#606060"},yt={earth:"#151515",glacier:"#1c1c1c",residential:"#252B2F",hospital:"#3E2C2C",cemetery:"#36483D",school:"#2C3440",industrial:"#33312C",wood:"#3A3E38",grass:"#4E604D",park:"#2C4034",water:"#4D5B73",sand:"#777777",buildings:"#464545",highwayCasing:"#000000",majorRoadCasing:"#1C1B1B",mediumRoadCasing:"#3E3E3E",minorRoadCasing:"#000000",highway:"#5B5B5B",majorRoad:"#595959",mediumRoad:"#4F4F4F",minorRoad:"#393939",boundaries:"#666666",mask:"#dddddd",countryLabel:"#ffffff",cityLabel:"#FFFFFF",stateLabel:"#ffffff",neighbourhoodLabel:"#FDFDFD",landuseLabel:"#DDDDDD",waterLabel:"#707E95",naturalLabel:"#4c4c4c",roadsLabel:"#C4C4C4",poisLabel:"#959393"};function xe(e,r,i){return Math.min(Math.max(e,i),r)}var ye=class extends Error{constructor(e){super(`Failed to parse color: "${e}"`)}};function Ui(e){if(typeof e!="string")throw new ye(e);if(e.trim().toLowerCase()==="transparent")return[0,0,0,0];let r=e.trim();r=Zi.test(e)?function(a){let o=a.toLowerCase().trim(),h=qi[function(f){let u=5381,p=f.length;for(;p;)u=33*u^f.charCodeAt(--p);return(u>>>0)%2341}(o)];if(!h)throw new ye(a);return`#${h}`}(e):e;let i=Ri.exec(r);if(i){let a=Array.from(i).slice(1);return[...a.slice(0,3).map(o=>parseInt(_e(o,2),16)),parseInt(_e(a[3]||"f",2),16)/255]}let t=Ni.exec(r);if(t){let a=Array.from(t).slice(1);return[...a.slice(0,3).map(o=>parseInt(o,16)),parseInt(a[3]||"ff",16)/255]}let n=Wi.exec(r);if(n){let a=Array.from(n).slice(1);return[...a.slice(0,3).map(o=>parseInt(o,10)),parseFloat(a[3]||"1")]}let s=$i.exec(r);if(s){let[a,o,h,f]=Array.from(s).slice(1).map(parseFloat);if(xe(0,100,o)!==o)throw new ye(e);if(xe(0,100,h)!==h)throw new ye(e);return[...Hi(a,o,h),f||1]}throw new ye(e)}var gt=e=>parseInt(e.replace(/_/g,""),36),qi="1q29ehhb 1n09sgk7 1kl1ekf_ _yl4zsno 16z9eiv3 1p29lhp8 _bd9zg04 17u0____ _iw9zhe5 _to73___ _r45e31e _7l6g016 _jh8ouiv _zn3qba8 1jy4zshs 11u87k0u 1ro9yvyo 1aj3xael 1gz9zjz0 _3w8l4xo 1bf1ekf_ _ke3v___ _4rrkb__ 13j776yz _646mbhl _nrjr4__ _le6mbhl 1n37ehkb _m75f91n _qj3bzfz 1939yygw 11i5z6x8 _1k5f8xs 1509441m 15t5lwgf _ae2th1n _tg1ugcv 1lp1ugcv 16e14up_ _h55rw7n _ny9yavn _7a11xb_ 1ih442g9 _pv442g9 1mv16xof 14e6y7tu 1oo9zkds 17d1cisi _4v9y70f _y98m8kc 1019pq0v 12o9zda8 _348j4f4 1et50i2o _8epa8__ _ts6senj 1o350i2o 1mi9eiuo 1259yrp0 1ln80gnw _632xcoy 1cn9zldc _f29edu4 1n490c8q _9f9ziet 1b94vk74 _m49zkct 1kz6s73a 1eu9dtog _q58s1rz 1dy9sjiq __u89jo3 _aj5nkwg _ld89jo3 13h9z6wx _qa9z2ii _l119xgq _bs5arju 1hj4nwk9 1qt4nwk9 1ge6wau6 14j9zlcw 11p1edc_ _ms1zcxe _439shk6 _jt9y70f _754zsow 1la40eju _oq5p___ _x279qkz 1fa5r3rv _yd2d9ip _424tcku _8y1di2_ _zi2uabw _yy7rn9h 12yz980_ __39ljp6 1b59zg0x _n39zfzp 1fy9zest _b33k___ _hp9wq92 1il50hz4 _io472ub _lj9z3eo 19z9ykg0 _8t8iu3a 12b9bl4a 1ak5yw0o _896v4ku _tb8k8lv _s59zi6t _c09ze0p 1lg80oqn 1id9z8wb _238nba5 1kq6wgdi _154zssg _tn3zk49 _da9y6tc 1sg7cv4f _r12jvtt 1gq5fmkz 1cs9rvci _lp9jn1c _xw1tdnb 13f9zje6 16f6973h _vo7ir40 _bt5arjf _rc45e4t _hr4e100 10v4e100 _hc9zke2 _w91egv_ _sj2r1kk 13c87yx8 _vqpds__ _ni8ggk8 _tj9yqfb 1ia2j4r4 _7x9b10u 1fc9ld4j 1eq9zldr _5j9lhpx _ez9zl6o _md61fzm".split(" ").reduce((e,r)=>{let i=gt(r.substring(0,3)),t=gt(r.substring(3)).toString(16),n="";for(let s=0;s<6-t.length;s++)n+="0";return e[i]=`${n}${t}`,e},{}),_e=(e,r)=>Array.from(Array(r)).map(()=>e).join(""),Ri=new RegExp(`^#${_e("([a-f0-9])",3)}([a-f0-9])?$`,"i"),Ni=new RegExp(`^#${_e("([a-f0-9]{2})",3)}([a-f0-9]{2})?$`,"i"),Wi=new RegExp(`^rgba?\\(\\s*(\\d+)\\s*${_e(",\\s*(\\d+)\\s*",2)}(?:,\\s*([\\d.]+))?\\s*\\)$`,"i"),$i=/^hsla?\(\s*([\d.]+)\s*,\s*([\d.]+)%\s*,\s*([\d.]+)%(?:\s*,\s*([\d.]+))?\s*\)$/i,Zi=/^[a-z]+$/i,vt=e=>Math.round(255*e),Hi=(e,r,i)=>{let t=i/100;if(r===0)return[t,t,t].map(vt);let n=(e%360+360)%360/60,s=(1-Math.abs(2*t-1))*(r/100),a=s*(1-Math.abs(n%2-1)),o=0,h=0,f=0;n>=0&&n<1?(o=s,h=a):n>=1&&n<2?(o=a,h=s):n>=2&&n<3?(h=s,f=a):n>=3&&n<4?(h=a,f=s):n>=4&&n<5?(o=a,f=s):n>=5&&n<6&&(o=s,f=a);let u=t-s/2;return[o+u,h+u,f+u].map(vt)};function xt(e){let[r,i,t,n]=Ui(e).map((f,u)=>u===3?f:f/255),s=Math.max(r,i,t),a=Math.min(r,i,t),o=(s+a)/2;if(s===a)return[0,0,o,n];let h=s-a;return[60*(r===s?(i-t)/h+(i<t?6:0):i===s?(t-r)/h+2:(r-i)/h+4),o>.5?h/(2-s-a):h/(s+a),o,n]}function Ki(e,r,i,t){return`hsla(${(e%360).toFixed()}, ${xe(0,100,100*r).toFixed()}%, ${xe(0,100,100*i).toFixed()}%, ${parseFloat(xe(0,1,t).toFixed(3))})`}var K=W(ie()),ws=W(Vr()),Gi=W(Ar()),R=class{constructor(e,r){this.str=e!=null?e:r,this.per_feature=typeof this.str=="function"&&this.str.length==2}get(e,r){return typeof this.str=="function"?this.str(e,r):this.str}},O=class{constructor(e,r=1){this.value=e!=null?e:r,this.per_feature=typeof this.value=="function"&&this.value.length==2}get(e,r){return typeof this.value=="function"?this.value(e,r):this.value}},$e=class{constructor(e){var r;this.label_props=(r=e==null?void 0:e.label_props)!=null?r:["name"],this.textTransform=e==null?void 0:e.textTransform}get(e,r){let i,t;typeof this.label_props=="function"?t=this.label_props(e,r):t=this.label_props;for(let s of t)if(r.props.hasOwnProperty(s)&&typeof r.props[s]=="string"){i=r.props[s];break}let n;return typeof this.textTransform=="function"?n=this.textTransform(e,r):n=this.textTransform,i&&n==="uppercase"?i=i.toUpperCase():i&&n==="lowercase"?i=i.toLowerCase():i&&n==="capitalize"&&(i=i.toLowerCase().split(" ").map(o=>o[0].toUpperCase()+o.slice(1)).join(" ")),i}},Ze=class{constructor(e){var r,i;e!=null&&e.font?this.font=e.font:(this.family=(r=e==null?void 0:e.fontFamily)!=null?r:"sans-serif",this.size=(i=e==null?void 0:e.fontSize)!=null?i:12,this.weight=e==null?void 0:e.fontWeight,this.style=e==null?void 0:e.fontStyle)}get(e,r){if(this.font)return typeof this.font=="function"?this.font(e,r):this.font;var i="";this.style&&(typeof this.style=="function"?i=this.style(e,r)+" ":i=this.style+" ");var t="";this.weight&&(typeof this.weight=="function"?t=this.weight(e,r)+" ":t=this.weight+" ");var n;typeof this.size=="function"?n=this.size(e,r):n=this.size;var s;return typeof this.family=="function"?s=this.family(e,r):s=this.family,`${i}${t}${n}px ${s}`}},Ji=class{constructor(e,r=[]){this.value=e!=null?e:r,this.per_feature=typeof this.value=="function"&&this.value.length==2}get(e,r){return typeof this.value=="function"?this.value(e,r):this.value}},wt=W(ie()),Qi=(e,r,i)=>{var t=[],n,s,a,o=0,h=0,f=0,u=0,p=0,g=0,x=0,w=0,_=0,M=0,T=0,d=0;if(e.length<2)return[];if(e.length===2)return f=Math.sqrt(Math.pow(e[1].x-e[0].x,2)+Math.pow(e[1].y-e[0].y,2)),[{length:f,beginIndex:0,beginDistance:0,endIndex:2,endDistance:f}];for(u=Math.sqrt(Math.pow(e[1].x-e[0].x,2)+Math.pow(e[1].y-e[0].y,2)),o=1,h=e.length-1;o<h;o++)n=e[o-1],s=e[o],a=e[o+1],g=s.x-n.x,x=s.y-n.y,w=a.x-s.x,_=a.y-s.y,p=Math.sqrt(w*w+_*_),f+=u,M=Math.acos((g*w+x*_)/(u*p)),(M>r||f-d>i)&&(t.push({length:f-d,beginDistance:d,beginIndex:T,endIndex:o+1,endDistance:f}),T=o,d=f),u=p;return o-T>0&&t.push({length:f-d+p,beginIndex:T,beginDistance:d,endIndex:o+1,endDistance:f+p}),t};function en(e,r,i,t){let n,s,a=0,o=[];var h=-1/0;for(let u of e){let p=Qi(u,Math.PI/45,r);for(let g of p)if(g.length>=r+t){let x=new wt.default(u[g.beginIndex].x,u[g.beginIndex].y),w=u[g.endIndex-1],_=new wt.default((w.x-x.x)/g.length,(w.y-x.y)/g.length);for(var f=t;f<g.length-r;f+=i)o.push({start:x.add(_.mult(f)),end:x.add(_.mult(f+r))})}}return o}function tn(e,r,i,t){let n=r.x-e.x,s=r.y-e.y,a=Math.sqrt(Math.pow(r.x-e.x,2)+Math.pow(r.y-e.y,2)),o=[];for(var h=0;h<i+t;h+=2*t){let f=h*1/a;o.push({x:e.x+f*n,y:e.y+f*s})}return o}function Ht(e,r){if(e.length<=r)return[e];let i=r-1,t=e.lastIndexOf(" ",i),n=e.indexOf(" ",i);if(t==-1&&n==-1)return[e];let s,a;return n==-1||t>=0&&i-t<n-i?(s=e.substring(0,t),a=e.substring(t+1,e.length)):(s=e.substring(0,n),a=e.substring(n+1,e.length)),[s,...Ht(a,r)]}var rn="\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3220-\u3229\u3248-\u324F\u3251-\u325F\u3280-\u3289\u32B1-\u32BF\u3400-\u4DB5\u4E00-\u9FEA\uF900-\uFA6D\uFA70-\uFAD9\u2000",_s=new RegExp("^["+rn+"]+$"),Kt=5400,_t;(function(e){e[e.Left=1]="Left",e[e.Center=2]="Center",e[e.Right=3]="Right"})(_t||(_t={}));var bt;(function(e){e[e.N=1]="N",e[e.NE=2]="NE",e[e.E=3]="E",e[e.SE=4]="SE",e[e.S=5]="S",e[e.SW=6]="SW",e[e.W=7]="W",e[e.NW=8]="NW"})(bt||(bt={}));var U=class{constructor(e){var r;this.pattern=e.pattern,this.fill=new R(e.fill,"black"),this.opacity=new O(e.opacity,1),this.stroke=new R(e.stroke,"black"),this.width=new O(e.width,0),this.per_feature=(r=this.fill.per_feature||this.opacity.per_feature||this.stroke.per_feature||this.width.per_feature||e.per_feature)!=null?r:!1,this.do_stroke=!1}before(e,r){if(!this.per_feature){e.globalAlpha=this.opacity.get(r),e.fillStyle=this.fill.get(r),e.strokeStyle=this.stroke.get(r);let i=this.width.get(r);i>0&&(this.do_stroke=!0),e.lineWidth=i}if(this.pattern){let i=e.createPattern(this.pattern,"repeat");i&&(e.fillStyle=i)}}draw(e,r,i,t){var n=!1;if(this.per_feature){e.globalAlpha=this.opacity.get(i,t),e.fillStyle=this.fill.get(i,t);var s=this.width.get(i,t);s&&(n=!0,e.strokeStyle=this.stroke.get(i,t),e.lineWidth=s)}let a=()=>{e.fill(),(n||this.do_stroke)&&e.stroke()};var o=0;e.beginPath();for(var h of r){o+h.length>Kt&&(a(),o=0,e.beginPath());for(var f=0;f<h.length;f++){let u=h[f];f==0?e.moveTo(u.x,u.y):e.lineTo(u.x,u.y)}o+=h.length}o>0&&a()}};function nn(e,r){let i=0;for(;r[i+1][0]<e;)i++;return i}function sn(e,r,i){return e*(i-r)+r}function an(e,r,i,t){let n=t[r+1][0]-t[r][0],s=e-t[r][0];return n===0?0:i===1?s/n:(Math.pow(i,s)-1)/(Math.pow(i,n)-1)}function ne(e,r){return i=>{if(r.length<1)return 0;if(i<=r[0][0])return r[0][1];if(i>=r[r.length-1][0])return r[r.length-1][1];let t=nn(i,r),n=an(i,t,e,r);return sn(n,r[t][1],r[t+1][1])}}var te=class{constructor(e){var r;this.color=new R(e.color,"black"),this.width=new O(e.width),this.opacity=new O(e.opacity),this.dash=e.dash?new Ji(e.dash):null,this.dashColor=new R(e.dashColor,"black"),this.dashWidth=new O(e.dashWidth,1),this.lineCap=new R(e.lineCap,"butt"),this.lineJoin=new R(e.lineJoin,"miter"),this.skip=!1,this.per_feature=!!((r=this.dash)!=null&&r.per_feature||this.color.per_feature||this.opacity.per_feature||this.width.per_feature||this.lineCap.per_feature||this.lineJoin.per_feature||e.per_feature)}before(e,r){this.per_feature||(e.strokeStyle=this.color.get(r),e.lineWidth=this.width.get(r),e.globalAlpha=this.opacity.get(r),e.lineCap=this.lineCap.get(r),e.lineJoin=this.lineJoin.get(r))}draw(e,r,i,t){if(this.skip)return;let n=()=>{this.per_feature&&(e.globalAlpha=this.opacity.get(i,t),e.lineCap=this.lineCap.get(i,t),e.lineJoin=this.lineJoin.get(i,t)),this.dash?(e.save(),this.per_feature?(e.lineWidth=this.dashWidth.get(i,t),e.strokeStyle=this.dashColor.get(i,t),e.setLineDash(this.dash.get(i,t))):e.setLineDash(this.dash.get(i)),e.stroke(),e.restore()):(e.save(),this.per_feature&&(e.lineWidth=this.width.get(i,t),e.strokeStyle=this.color.get(i,t)),e.stroke(),e.restore())};var s=0;e.beginPath();for(var a of r){s+a.length>Kt&&(n(),s=0,e.beginPath());for(var o=0;o<a.length;o++){let h=a[o];o==0?e.moveTo(h.x,h.y):e.lineTo(h.x,h.y)}s+=a.length}s>0&&n()}};var Ne=class{constructor(e){this.radius=new O(e.radius,3),this.fill=new R(e.fill,"black"),this.stroke=new R(e.stroke,"white"),this.width=new O(e.width,0),this.opacity=new O(e.opacity)}draw(e,r,i,t){e.globalAlpha=this.opacity.get(i,t);let n=this.radius.get(i,t),s=this.width.get(i,t);s>0&&(e.strokeStyle=this.stroke.get(i,t),e.lineWidth=s,e.beginPath(),e.arc(r[0][0].x,r[0][0].y,n+s/2,0,2*Math.PI),e.stroke()),e.fillStyle=this.fill.get(i,t),e.beginPath(),e.arc(r[0][0].x,r[0][0].y,n,0,2*Math.PI),e.fill()}place(e,r,i){let t=r[0],n=new K.default(r[0][0].x,r[0][0].y),s=this.radius.get(e.zoom,i),a={minX:n.x-s,minY:n.y-s,maxX:n.x+s,maxY:n.y+s};return[{anchor:n,bboxes:[a],draw:h=>{this.draw(h,[[new K.default(0,0)]],e.zoom,i)}}]}},on=class{constructor(e){this.font=new Ze(e),this.text=new $e(e),this.fill=new R(e.fill,"black"),this.background=new R(e.background,"white"),this.padding=new O(e.padding,0)}place(e,r,i){let t=this.text.get(e.zoom,i);if(!t)return;let n=this.font.get(e.zoom,i);e.scratch.font=n;let s=e.scratch.measureText(t),a=s.width,o=s.actualBoundingBoxAscent,h=s.actualBoundingBoxDescent,f=r[0],u=new K.default(r[0][0].x,r[0][0].y),p=this.padding.get(e.zoom,i),g={minX:u.x-a/2-p,minY:u.y-o-p,maxX:u.x+a/2+p,maxY:u.y+h+p};return[{anchor:u,bboxes:[g],draw:w=>{w.globalAlpha=1,w.fillStyle=this.background.get(e.zoom,i),w.fillRect(-a/2-p,-o-p,a+2*p,o+h+2*p),w.fillStyle=this.fill.get(e.zoom,i),w.font=n,w.fillText(t,-a/2,0)}}]}},zt=class{constructor(e){this.list=e}place(e,r,i){var t=this.list[0].place(e,r,i);if(!t)return;var n=t[0];let s=n.anchor,a=n.bboxes[0],o=a.maxY-a.minY,h=[{draw:n.draw,translate:{x:0,y:0}}],f=[[new K.default(r[0][0].x,r[0][0].y+o)]];for(let p=1;p<this.list.length;p++)t=this.list[p].place(e,f,i),t&&(n=t[0],a=Gt(a,n.bboxes[0]),h.push({draw:n.draw,translate:{x:0,y:o}}));return[{anchor:s,bboxes:[a],draw:p=>{for(let g of h)p.save(),p.translate(g.translate.x,g.translate.y),g.draw(p),p.restore()}}]}},Gt=(e,r)=>({minX:Math.min(e.minX,r.minX),minY:Math.min(e.minY,r.minY),maxX:Math.max(e.maxX,r.maxX),maxY:Math.max(e.maxY,r.maxY)}),kt=class{constructor(e){this.list=e}place(e,r,i){let t=this.list[0];if(!t)return;var n=t.place(e,r,i);if(!n)return;var s=n[0];let a=s.anchor,o=s.bboxes[0],h=[s.draw];for(let u=1;u<this.list.length;u++){if(n=this.list[u].place(e,r,i),!n)return;s=n[0],o=Gt(o,s.bboxes[0]),h.push(s.draw)}return[{anchor:a,bboxes:[o],draw:u=>{h.forEach(p=>p(u))}}]}},ln=class{constructor(e){this.symbolizer=e}place(e,r,i){let t=r[0][0],n=this.symbolizer.place(e,[[new K.default(0,0)]],i);if(!n||n.length==0)return;let s=n[0],a=s.bboxes[0],o=a.maxX-a.minX,h=a.maxY-a.minY,f={minX:t.x-o/2,maxX:t.x+o/2,minY:t.y-h/2,maxY:t.y+h/2};return[{anchor:t,bboxes:[f],draw:p=>{p.translate(-o/2,h/2-a.maxY),s.draw(p,{justify:2})}}]}};var He=class{constructor(e){this.font=new Ze(e),this.text=new $e(e),this.fill=new R(e.fill,"black"),this.stroke=new R(e.stroke,"black"),this.width=new O(e.width,0),this.lineHeight=new O(e.lineHeight,1),this.letterSpacing=new O(e.letterSpacing,0),this.maxLineCodeUnits=new O(e.maxLineChars,15),this.justify=e.justify}place(e,r,i){let t=this.text.get(e.zoom,i);if(!t)return;let n=this.font.get(e.zoom,i);e.scratch.font=n;let s=this.letterSpacing.get(e.zoom,i),a=Ht(t,this.maxLineCodeUnits.get(e.zoom,i));var o="",h=0;for(let T of a)T.length>h&&(h=T.length,o=T);let f=e.scratch.measureText(o),u=f.width+s*(h-1),p=f.actualBoundingBoxAscent,g=f.actualBoundingBoxDescent,x=(p+g)*this.lineHeight.get(e.zoom,i),w=new K.default(r[0][0].x,r[0][0].y),_={minX:w.x,minY:w.y-p,maxX:w.x+u,maxY:w.y+g+(a.length-1)*x};return[{anchor:w,bboxes:[_],draw:(T,d)=>{T.globalAlpha=1,T.font=n,T.fillStyle=this.fill.get(e.zoom,i);let m=this.width.get(e.zoom,i);var y=0;for(let C of a){var z=0;if(this.justify==2||d&&d.justify==2?z=(u-T.measureText(C).width)/2:(this.justify==3||d&&d.justify==3)&&(z=u-T.measureText(C).width),m)if(T.lineWidth=m*2,T.strokeStyle=this.stroke.get(e.zoom,i),s>0){var k=z;for(var b of C)T.strokeText(b,k,y),k+=T.measureText(b).width+s}else T.strokeText(C,z,y);if(s>0){var k=z;for(var b of C)T.fillText(b,k,y),k+=T.measureText(b).width+s}else T.fillText(C,z,y);y+=x}}}]}},ge=class{constructor(e){this.centered=new ln(new He(e))}place(e,r,i){return this.centered.place(e,r,i)}},hn=class{constructor(e,r){var i,t,n;this.symbolizer=e,this.offsetX=new O(r.offsetX,0),this.offsetY=new O(r.offsetY,0),this.justify=(i=r.justify)!=null?i:void 0,this.placements=(t=r.placements)!=null?t:[2,6,8,4,1,3,5,7],this.ddValues=(n=r.ddValues)!=null?n:()=>({})}place(e,r,i){if(i.geomType!==ue.Point)return;let t=r[0][0],n=this.symbolizer.place(e,[[new K.default(0,0)]],i);if(!n||n.length==0)return;let s=n[0],a=s.bboxes[0],o=this.offsetX,h=this.offsetY,f=this.justify,u=this.placements,{offsetX:p,offsetY:g,justify:x,placements:w}=this.ddValues(e.zoom,i)||{};p&&(o=new O(p,0)),g&&(h=new O(g,0)),x&&(f=x),w&&(u=w);let _=o.get(e.zoom,i),M=h.get(e.zoom,i),T=(k,b)=>({minX:k.x+b.x+a.minX,minY:k.y+b.y+a.minY,maxX:k.x+b.x+a.maxX,maxY:k.y+b.y+a.maxY});var d=new K.default(_,M),m;let y=k=>{k.translate(d.x,d.y),s.draw(k,{justify:m})},z=(k,b)=>{let C=T(k,b);if(!e.index.bboxCollides(C,e.order))return[{anchor:t,bboxes:[C],draw:y}]};for(let k of u){let b=this.computeXAxisOffset(_,a,k),C=this.computeYAxisOffset(M,a,k);return m=this.computeJustify(f,k),d=new K.default(b,C),z(t,d)}}computeXAxisOffset(e,r,i){let t=r.maxX,n=t/2;return[1,5].includes(i)?e-n:[8,7,6].includes(i)?e-t:e}computeYAxisOffset(e,r,i){let t=Math.abs(r.minY),n=r.maxY,s=(r.minY+r.maxY)/2;return[3,7].includes(i)?e-s:[8,2,1].includes(i)?e-n:[6,4,5].includes(i)?e+t:e}computeJustify(e,r){return e||([1,5].includes(r)?2:[2,3,4].includes(r)?1:3)}},Te=class{constructor(e){this.symbolizer=new hn(new He(e),e)}place(e,r,i){return this.symbolizer.place(e,r,i)}},Mt;(function(e){e[e.Above=1]="Above",e[e.Center=2]="Center",e[e.Below=3]="Below"})(Mt||(Mt={}));var fn=class{constructor(e){var r;this.font=new Ze(e),this.text=new $e(e),this.fill=new R(e.fill,"black"),this.stroke=new R(e.stroke,"black"),this.width=new O(e.width,0),this.offset=new O(e.offset,0),this.position=(r=e.position)!=null?r:1,this.maxLabelCodeUnits=new O(e.maxLabelChars,40),this.repeatDistance=new O(e.repeatDistance,250)}place(e,r,i){let t=this.text.get(e.zoom,i);if(!t||t.length>this.maxLabelCodeUnits.get(e.zoom,i))return;let n=20,s=i.bbox;if(s.maxY-s.minY<n&&s.maxX-s.minX<n)return;let a=this.font.get(e.zoom,i);e.scratch.font=a;let o=e.scratch.measureText(t),h=o.width,f=o.actualBoundingBoxAscent+o.actualBoundingBoxDescent;var u=this.repeatDistance.get(e.zoom,i);e.overzoom>4&&(u*=1<<e.overzoom-4);let p=f*2,g=en(r,h,u,p);if(g.length==0)return;let x=[];for(let w of g){let _=w.end.x-w.start.x,M=w.end.y-w.start.y,d=tn(w.start,w.end,h,p/2).map(y=>({minX:y.x-p/2,minY:y.y-p/2,maxX:y.x+p/2,maxY:y.y+p/2})),m=y=>{y.globalAlpha=1,y.rotate(Math.atan2(M,_)),_<0&&(y.scale(-1,-1),y.translate(-h,0));let z=0;this.position===3?z+=f:this.position===2&&(z+=f/2),y.translate(0,z-this.offset.get(e.zoom,i)),y.font=a;let k=this.width.get(e.zoom,i);k&&(y.lineWidth=k,y.strokeStyle=this.stroke.get(e.zoom,i),y.strokeText(t,0,0)),y.fillStyle=this.fill.get(e.zoom,i),y.fillText(t,0,0)};x.push({anchor:w.start,bboxes:d,draw:m,deduplicationKey:t,deduplicationDistance:u})}return x}},je=class{constructor(e){this.symbolizer=new He(e)}place(e,r,i){let t=i.bbox;if((t.maxY-t.minY)*(t.maxX-t.minX)<2e4)return;let s=this.symbolizer.place(e,[[new K.default(0,0)]],i);if(!s||s.length==0)return;let a=s[0],o=a.bboxes[0],h=r[0],f=(0,Gi.default)([h.map(x=>[x.x,x.y])]),u=new K.default(f[0],f[1]),p={minX:u.x-(o.maxX-o.minX)/2,minY:u.y-(o.maxY-o.minY)/2,maxX:u.x+(o.maxX-o.minX)/2,maxY:u.y+(o.maxY-o.minY)/2};return[{anchor:u,bboxes:[p],draw:x=>{x.translate(a.anchor.x-(o.maxX-o.minX)/2,a.anchor.y),a.draw(x)}}]}},Jt=(e,r)=>{let i=xt(r),t=Sr({},e);for(let[n,s]of Object.entries(e)){let a=xt(s);t[n]=Ki(i[0],i[1],a[2],a[3])}return t},Lt=(e,r)=>(r&&(e=Jt(e,r)),[{dataLayer:"earth",symbolizer:new U({fill:e.earth})},{dataLayer:"natural",symbolizer:new U({fill:e.glacier}),filter:(i,t)=>t.props.natural=="glacier"},{dataLayer:"landuse",symbolizer:new U({fill:e.residential}),filter:(i,t)=>t.props.landuse=="residential"||t.props.place=="neighbourhood"},{dataLayer:"landuse",symbolizer:new U({fill:e.hospital}),filter:(i,t)=>t.props.amenity=="hospital"},{dataLayer:"landuse",symbolizer:new U({fill:e.cemetery}),filter:(i,t)=>t.props.landuse=="cemetery"},{dataLayer:"landuse",symbolizer:new U({fill:e.school}),filter:(i,t)=>t.props.amenity=="school"||t.props.amenity=="kindergarten"||t.props.amenity=="university"||t.props.amenity=="college"},{dataLayer:"landuse",symbolizer:new U({fill:e.industrial}),filter:(i,t)=>t.props.landuse=="industrial"},{dataLayer:"natural",symbolizer:new U({fill:e.wood}),filter:(i,t)=>t.props.natural=="wood"},{dataLayer:"landuse",symbolizer:new U({fill:e.grass}),filter:(i,t)=>t.props.landuse=="grass"},{dataLayer:"landuse",symbolizer:new U({fill:e.park}),filter:(i,t)=>t.props.leisure=="park"},{dataLayer:"water",symbolizer:new U({fill:e.water})},{dataLayer:"natural",symbolizer:new U({fill:e.sand}),filter:(i,t)=>t.props.natural=="sand"},{dataLayer:"buildings",symbolizer:new U({fill:e.buildings})},{dataLayer:"roads",symbolizer:new te({color:e.highwayCasing,width:ne(1.4,[[5,1.5],[11,4],[16,9],[20,40]])}),filter:(i,t)=>t.props["pmap:kind"]=="highway"},{dataLayer:"roads",symbolizer:new te({color:e.majorRoadCasing,width:ne(1.4,[[9,3],[12,4],[17,8],[20,22]])}),filter:(i,t)=>t.props["pmap:kind"]=="major_road"},{dataLayer:"roads",symbolizer:new te({color:e.mediumRoadCasing,width:ne(1.4,[[13,3],[17,6],[20,18]])}),filter:(i,t)=>t.props["pmap:kind"]=="medium_road"},{dataLayer:"roads",symbolizer:new te({color:e.minorRoadCasing,width:ne(1.4,[[14,2],[17,5],[20,15]])}),filter:(i,t)=>t.props["pmap:kind"]=="minor_road"},{dataLayer:"roads",symbolizer:new te({color:e.minorRoad,width:ne(1.4,[[14,1],[17,3],[20,13]])}),filter:(i,t)=>t.props["pmap:kind"]=="minor_road"},{dataLayer:"roads",symbolizer:new te({color:e.mediumRoad,width:ne(1.4,[[13,2],[17,4],[20,15]])}),filter:(i,t)=>t.props["pmap:kind"]=="medium_road"},{dataLayer:"roads",symbolizer:new te({color:e.majorRoad,width:ne(1.4,[[9,2],[12,3],[17,6],[20,20]])}),filter:(i,t)=>t.props["pmap:kind"]=="major_road"},{dataLayer:"roads",symbolizer:new te({color:e.highway,width:ne(1.4,[[5,.5],[11,2.5],[16,7],[20,30]])}),filter:(i,t)=>t.props["pmap:kind"]=="highway"},{dataLayer:"boundaries",symbolizer:new te({color:e.boundaries,width:2,opacity:.4})},{dataLayer:"mask",symbolizer:new U({fill:e.mask})}]),Ct=(e,r,i,t)=>{r&&(e=Jt(e,r));var n=["name"];i&&(n=i);let s=(a,o)=>t?a instanceof Te?new zt([a,new Te({fill:o,label_props:t})]):new zt([a,new ge({fill:o,label_props:t})]):a;return[{dataLayer:"places",symbolizer:s(new ge({label_props:n,fill:e.countryLabel,lineHeight:1.5,font:(a,o)=>a<6?"200 14px sans-serif":"200 20px sans-serif",textTransform:"uppercase"}),e.countryLabel),filter:(a,o)=>o.props["pmap:kind"]=="country"},{dataLayer:"places",symbolizer:s(new ge({label_props:n,fill:e.stateLabel,font:"300 16px sans-serif"}),e.stateLabel),filter:(a,o)=>o.props["pmap:kind"]=="state"},{id:"cities_high",dataLayer:"places",filter:(a,o)=>o.props["pmap:kind"]=="city",minzoom:7,symbolizer:s(new ge({label_props:n,fill:e.cityLabel,font:(a,o)=>(o==null?void 0:o.props["pmap:rank"])===1?a>8?"600 20px sans-serif":"600 12px sans-serif":a>8?"600 16px sans-serif":"600 10px sans-serif"}),e.cityLabel),sort:(a,o)=>a["pmap:rank"]-o["pmap:rank"]},{id:"cities_low",dataLayer:"places",filter:(a,o)=>o.props["pmap:kind"]=="city",maxzoom:6,symbolizer:new kt([new Ne({radius:2,fill:e.cityLabel}),s(new Te({label_props:n,fill:e.cityLabel,offsetX:2,offsetY:2,font:(a,o)=>(o==null?void 0:o.props["pmap:rank"])===1?a>8?"600 20px sans-serif":"600 12px sans-serif":a>8?"600 16px sans-serif":"600 10px sans-serif"}),e.cityLabel)]),sort:(a,o)=>a["pmap:rank"]-o["pmap:rank"]},{id:"neighbourhood",dataLayer:"places",symbolizer:s(new ge({label_props:n,fill:e.neighbourhoodLabel,font:"500 10px sans-serif",textTransform:"uppercase"}),e.neighbourhoodLabel),filter:(a,o)=>o.props["pmap:kind"]=="neighbourhood"},{dataLayer:"landuse",symbolizer:s(new je({label_props:n,fill:e.landuseLabel,font:"300 12px sans-serif"}),e.landuseLabel)},{dataLayer:"water",symbolizer:s(new je({label_props:n,fill:e.waterLabel,font:"italic 600 12px sans-serif"}),e.waterLabel)},{dataLayer:"natural",symbolizer:s(new je({label_props:n,fill:e.naturalLabel,font:"italic 300 12px sans-serif"}),e.naturalLabel)},{dataLayer:"roads",symbolizer:s(new fn({label_props:n,fill:e.roadsLabel,font:"500 12px sans-serif"}),e.roadsLabel),minzoom:12},{dataLayer:"roads",symbolizer:new on({label_props:["ref"],font:"600 9px sans-serif",background:e.highway,padding:2,fill:e.neighbourhoodLabel}),filter:(a,o)=>o.props["pmap:kind"]=="highway"},{dataLayer:"pois",symbolizer:new kt([new Ne({radius:2,fill:e.poisLabel}),s(new Te({label_props:n,fill:e.poisLabel,offsetX:2,offsetY:2,font:"300 10px sans-serif"}),e.poisLabel)])}]},Tt=(e,r,i)=>[{dataSource:e,dataLayer:r,symbolizer:new Ne({opacity:.2,fill:i,radius:4}),filter:(t,n)=>n.geomType==ue.Point},{dataSource:e,dataLayer:r,symbolizer:new te({opacity:.2,color:i,width:2}),filter:(t,n)=>n.geomType==ue.Line},{dataSource:e,dataLayer:r,symbolizer:new U({opacity:.2,fill:i,stroke:i,width:1}),filter:(t,n)=>n.geomType==ue.Polygon}],un=(e,r)=>{var i=[];for(var[t,n]of e)for(var s of n)for(var a of s.data.keys())t===r.dataSource&&a===r.dataLayer||(i=i.concat(Tt(t,a,"steelblue")));return i=i.concat(Tt(r.dataSource||"",r.dataLayer,"red")),i},dn=6378137;var bs=dn*Math.PI;var cn=W(ie()),pn=e=>new Promise((r,i)=>{setTimeout(()=>{r()},e)}),mn=e=>e.then(r=>({status:"fulfilled",value:r}),r=>({status:"rejected",reason:r})),Qt=(e={})=>{class r extends L.GridLayer{constructor(t={}){t.noWrap&&!t.bounds&&(t.bounds=[[-90,-180],[90,180]]),t.attribution==null&&(t.attribution='<a href="https://protomaps.com">Protomaps</a> \xA9 <a href="https://openstreetmap.org/copyright">OpenStreetMap</a>'),super(t);let n=t.dark?yt:mt;this.paint_rules=t.paint_rules||Lt(n,t.shade),this.label_rules=t.label_rules||Ct(n,t.shade,t.language1,t.language2),this.backgroundColor=t.backgroundColor,this.lastRequestedZ=void 0,this.xray=t.xray,this.tasks=t.tasks||[],this.views=Ei(t),this.debug=t.debug;let s=document.createElement("canvas").getContext("2d");this.scratch=s,this.onTilesInvalidated=a=>{a.forEach(o=>{this.rerenderTile(o)})},this.labelers=new pt(this.scratch,this.label_rules,16,this.onTilesInvalidated),this.tile_size=256*window.devicePixelRatio,this.tileDelay=t.tileDelay||3,this.lang=t.lang,this.inspector=this.inspect(this)}setDefaultStyle(t,n,s,a){let o=t?yt:mt;this.paint_rules=Lt(o,n),this.label_rules=Ct(o,n,s,a)}renderTile(t,n,s,a=()=>{}){return de(this,null,function*(){this.lastRequestedZ=t.z;let o=[];for(let[b,C]of this.views){let B=C.getDisplayTile(t);o.push({key:b,promise:B})}let h=yield Promise.all(o.map(b=>b.promise.then(C=>({status:"fulfilled",value:C,key:b.key}),C=>({status:"rejected",reason:C,key:b.key})))),f=new Map;for(let b of h)b.status==="fulfilled"?f.set(b.key,[b.value]):b.reason.name==="AbortError"||console.error(b.reason);if(n.key!=s||this.lastRequestedZ!==t.z||(yield Promise.all(this.tasks.map(mn)),n.key!=s)||this.lastRequestedZ!==t.z)return;let u=this.labelers.add(t.z,f);if(n.key!=s||this.lastRequestedZ!==t.z)return;let p=this.labelers.getIndex(t.z);if(!this._map)return;let g=this._map.getCenter().wrap(),x=this._getTiledPixelBounds(g),w=this._pxBoundsToTileRange(x),_=w.getCenter(),M=t.distanceTo(_)*this.tileDelay;if(yield pn(M),n.key!=s||this.lastRequestedZ!==t.z)return;let T=16,d={minX:256*t.x-T,minY:256*t.y-T,maxX:256*(t.x+1)+T,maxY:256*(t.y+1)+T},m=new cn.default(256*t.x,256*t.y);n.width=this.tile_size,n.height=this.tile_size;let y=n.getContext("2d");y.setTransform(this.tile_size/256,0,0,this.tile_size/256,0,0),y.clearRect(0,0,256,256),this.backgroundColor&&(y.save(),y.fillStyle=this.backgroundColor,y.fillRect(0,0,256,256),y.restore());var z=0;let k=this.paint_rules;if(this.xray&&(k=un(f,this.xray)),z=Yi(y,t.z,f,this.xray?null:p,k,d,m,!1,this.debug),this.debug){y.save(),y.fillStyle=this.debug,y.font="600 12px sans-serif",y.fillText(t.z+" "+t.x+" "+t.y,4,14),y.font="12px sans-serif";let b=28;for(let[C,B]of f){let D=B[0].data_tile;y.fillText(C+(C?" ":"")+D.z+" "+D.x+" "+D.y,4,b),b+=14}y.font="600 10px sans-serif",z>8&&(y.fillText(z.toFixed()+" ms paint",4,b),b+=14),u>8&&y.fillText(u.toFixed()+" ms layout",4,b),y.strokeStyle=this.debug,y.lineWidth=.5,y.beginPath(),y.moveTo(0,0),y.lineTo(0,256),y.stroke(),y.lineWidth=.5,y.beginPath(),y.moveTo(0,0),y.lineTo(256,0),y.stroke(),y.restore()}a()})}rerenderTile(t){for(let n in this._tiles){let s=this._wrapCoords(this._keyToTileCoords(n));t===this._tileCoordsToKey(s)&&this.renderTile(s,this._tiles[n].el,t)}}clearLayout(){this.labelers=new pt(this.scratch,this.label_rules,16,this.onTilesInvalidated)}rerenderTiles(){for(let t in this._tiles){let n=this._wrapCoords(this._keyToTileCoords(t)),s=this._tileCoordsToKey(n);this.renderTile(n,this._tiles[t].el,s)}}createTile(t,n){let s=L.DomUtil.create("canvas","leaflet-tile");s.lang=this.lang;let a=this._tileCoordsToKey(t);return s.key=a,this.renderTile(t,s,a,()=>{n(null,s)}),s}_removeTile(t){let n=this._tiles[t];n&&(n.el.removed=!0,n.el.key=void 0,L.DomUtil.removeClass(n.el,"leaflet-tile-loaded"),n.el.width=n.el.height=0,L.DomUtil.remove(n.el),delete this._tiles[t],this.fire("tileunload",{tile:n.el,coords:this._keyToTileCoords(t)}))}queryFeatures(t,n){let s=new Map;for(var[a,o]of this.views)s.set(a,o.queryFeatures(t,n,this._map.getZoom()));return s}inspect(t){return n=>{let s=["\u25CE","\u27CD","\u25FB"],a=t._map.wrapLatLng(n.latlng),o=t.queryFeatures(a.lng,a.lat);var h="";let f=!0;for(var[u,p]of o)for(var g of p)if(!(this.xray&&this.xray!==!0&&!((this.xray.dataSource||"")===u&&this.xray.dataLayer===g.layerName))){h=h+`<div style="margin-top:${f?0:.5}em">${s[g.feature.geomType-1]} <b>${u} ${u?"/":""} ${g.layerName}</b> ${g.feature.id||""}</div>`;for(let x in g.feature.props)h=h+`<div style="font-size:0.9em">${x} = ${g.feature.props[x]}</div>`;f=!1}f&&(h="No features."),L.popup().setLatLng(n.latlng).setContent('<div style="max-height:400px;overflow-y:scroll;padding-right:8px">'+h+"</div>").openOn(t._map)}}addInspector(t){return t.on("click",this.inspector)}removeInspector(t){return t.off("click",this.inspector)}}return new r(e)};import{createElementObject as yn,createTileLayerComponent as gn,updateGridLayer as vn}from"@react-leaflet/core";var er=gn(({...e},r)=>{let i=Qt(e);return yn(i,r)},vn);var kn=zn(_n)`
  ${({theme:e})=>`
      font-family: ${e.global.font.family};
      height: 100%;
    `}
`,Mn=xn(({center:e=[0,0],children:r,scrollWheelZoom:i=!0,tileLayer:t,theme:n,maxZoom:s=18,zoom:a=1,zoomControl:o=!1,...h},f)=>{let u=wn(tr),p=rr(u,{map:rr(st,n)});return De.createElement(tr.Provider,{value:p},De.createElement(kn,{attributionControl:!1,center:e,ref:f,scrollWheelZoom:i,maxZoom:s,zoom:a,zoomControl:o,...h},De.createElement(bn,{position:"bottomright",prefix:!1}),De.createElement(er,{attribution:t.attribution,url:t.url}),r))});Mn.propTypes={center:J.array,children:J.any,scrollWheelZoom:J.string||J.bool,maxZoom:J.number,tileLayer:J.shape({attribution:J.string,url:J.string.isRequired}).isRequired,theme:J.object,zoom:J.number,zoomControl:J.bool};import ze,{useContext as Ln}from"react";import ir from"prop-types";import Cn from"react-dom/server";import{v4 as Tn}from"uuid";import{ThemeContext as nr}from"styled-components";import{Marker as Sn,Popup as Fn}from"react-leaflet";import Bn from"leaflet";var Dn=({icon:e,popup:r,...i})=>{var a;let t=Ln(nr),n=(a=e==null?void 0:e.props)==null?void 0:a.kind,s=r?ze.createElement(Fn,null,ze.createElement(Pe,null,r)):void 0;return ze.createElement(Sn,{key:Tn(),icon:Bn.divIcon({className:"grommet-marker",html:Cn.renderToString(ze.createElement(nr.Provider,{value:t},e||ze.createElement(Ke,null)))}),kind:n,...i},s)};Dn.propTypes={icon:ir.node,popup:ir.node};import ce,{useContext as Pn}from"react";import sr from"prop-types";import{ThemeContext as Ge}from"styled-components";import{createElementObject as En,createPathComponent as Xn,extendContext as Yn}from"@react-leaflet/core";import or from"leaflet";import"leaflet.markercluster";import ar from"react-dom/server";var Vn=({...e},r)=>{let i=new or.MarkerClusterGroup({showCoverageOnHover:!1,zoomToBoundsOnClick:!1,...e});return En(i,Yn(r,{layerContainer:i}))},In=Xn(Vn),An=({icon:e,popup:r,...i})=>{let t=Pn(Ge);return ce.createElement(In,{iconCreateFunction:n=>{if(r){let s=n.bindPopup(ar.renderToString(ce.createElement(Ge.Provider,{value:t},ce.createElement(Pe,null,r({cluster:n})))));n.on("click",()=>{s.openPopup()})}return or.divIcon({className:"grommet-cluster-group",html:ar.renderToString(ce.createElement(Ge.Provider,{value:t},e?ce.cloneElement(e({cluster:n}),{cluster:n}):ce.createElement(Ye,{cluster:n})))})},...i})};An.propTypes={icon:sr.func,popup:sr.func};import Je from"react";import On from"prop-types";import jn from"styled-components";import{Box as Un,ThemeContext as qn}from"grommet";var Rn=jn(Un)`
  // to create the pin shape
  border-bottom-right-radius: 0;
  // translate to re-align with leaflet div
  transform: rotate(45deg) translateX(-35%);
  &:hover {
    transform: rotate(45deg) translateX(-35%) scale(1.1);
    transition: transform 0.4s;
  }
`,Ke=({kind:e="default"})=>{var n,s,a,o,h,f,u,p,g;let r=Je.useContext(qn),i=ke([(a=(s=(n=r==null?void 0:r.map)==null?void 0:n.pin)==null?void 0:s.default)==null?void 0:a.container,(f=(h=(o=r==null?void 0:r.map)==null?void 0:o.pin)==null?void 0:h[e])==null?void 0:f.container]),t=(g=(p=(u=r==null?void 0:r.map)==null?void 0:u.pin)==null?void 0:p[e])==null?void 0:g.icon;return t&&(t=Je.cloneElement(t,{style:{transform:"rotate(-45deg)"}})),Je.createElement(Rn,{...i},t)};Ke.propTypes={kind:On.string};import Nn,{useContext as Wn}from"react";import{ThemeContext as $n}from"styled-components";import{Box as Zn}from"grommet";var Pe=({...e})=>{var i;let r=Wn($n);return Nn.createElement(Zn,{...(i=r==null?void 0:r.map)==null?void 0:i.popup,...e})};window.console=console;var Hn=console.error,Kn=["useLayoutEffect does nothing on the server, because its effect cannot"];console.error=function(r,...i){Kn.some(t=>r.includes(t))||Hn(r,...i)};export{Ye as Cluster,_r as Controls,xr as LocationBounds,Mn as Map,Dn as Marker,An as MarkerCluster,Ke as Pin,Pe as Popup,st as base,ke as normalizeTheme};
/*! Bundled license information:

protomaps/dist/protomaps.module.js:
  (*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> *)
*/
//# sourceMappingURL=index.esm.js.map
