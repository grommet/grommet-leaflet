"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const n=require("react/jsx-runtime"),u=require("react"),a=require("prop-types"),l=require("styled-components"),p=require("grommet"),j=require("grommet/utils"),b=require("/home/runner/work/grommet-leaflet/grommet-leaflet/node_modules/react-leaflet/lib/index.js"),y=require("/home/runner/work/grommet-leaflet/grommet-leaflet/node_modules/leaflet/dist/leaflet-src.js"),T=require("/home/runner/work/grommet-leaflet/grommet-leaflet/node_modules/grommet-icons/es6/index.js"),v=require("/home/runner/work/grommet-leaflet/grommet-leaflet/node_modules/protomaps/dist/protomaps.module.js"),C=require("/home/runner/work/grommet-leaflet/grommet-leaflet/node_modules/@react-leaflet/core/lib/index.js"),k=require("react-dom/server"),J=require("/home/runner/work/grommet-leaflet/grommet-leaflet/node_modules/uuid/dist/esm-browser/index.js");require("/home/runner/work/grommet-leaflet/grommet-leaflet/node_modules/leaflet.markercluster/dist/leaflet.markercluster-src.js");const M=r=>{let e={};return r.forEach(t=>{e=j.deepMerge(e,t)}),e},K=l(p.Box)`
  // translate to re-align with leaflet div
  transform: translateX(-35%);
  &:hover {
    transform: translateX(-35%) scale(1.1);
    transition: transform 0.4s;
  }
`,F=l(p.Text)`
  // multiplier of font-size, for tighter alignment
  line-height: 1rem;
`,B=({cluster:r,kind:e="default",size:t="medium",...i})=>{var d,m,x,f,w,z,E,P,L,O,R,_,N;const o=u.useContext(l.ThemeContext),s=M([(x=(m=(d=o==null?void 0:o.map)==null?void 0:d.cluster)==null?void 0:m.size)==null?void 0:x.medium,(z=(w=(f=o==null?void 0:o.map)==null?void 0:f.cluster)==null?void 0:w.size)==null?void 0:z[t],(P=(E=o==null?void 0:o.map)==null?void 0:E.cluster)==null?void 0:P.default,(O=(L=o==null?void 0:o.map)==null?void 0:L.cluster)==null?void 0:O[e]]),c=r.getChildCount(),g=(N=(_=(R=o==null?void 0:o.map)==null?void 0:R.cluster)==null?void 0:_[e])==null?void 0:N.icon,h=c;return n.jsxs(K,{...s==null?void 0:s.container,...i,children:[g,n.jsx(F,{...s==null?void 0:s.label,children:h})]})};B.propTypes={cluster:a.object,kind:a.string,size:a.string};const D=({locations:r})=>{const e=y.latLngBounds();return r.features?r.features.forEach(t=>{var i,o;e.extend([(i=t.geometry)==null?void 0:i.coordinates[0],(o=t.geometry)==null?void 0:o.coordinates[1]])}):r.forEach(t=>{e.extend([t==null?void 0:t[0],t==null?void 0:t[1]])}),e},H=1.5,G=({locations:r})=>{const e=b.useMap(),t=r&&D({locations:r}),[i,o]=u.useState(!1);return u.useEffect(()=>{t&&!i&&(JSON.stringify(t._northEast)===JSON.stringify(t._southWest)||e.flyToBounds(t,{duration:H}))},[t,e,i]),u.useEffect(()=>{o(!0)},[]),n.jsx(p.Box,{className:"leaflet-bottom leaflet-right",children:n.jsx(p.Box,{className:"leaflet-control",children:n.jsxs(p.Box,{elevation:"large",round:"medium",background:"background",children:[n.jsx(p.Button,{a11yTitle:"Zoom in",icon:n.jsx(T.Add,{}),onClick:s=>{s.preventDefault(),e.zoomIn()}}),n.jsx(p.Button,{a11yTitle:"Zoom out",icon:n.jsx(T.Subtract,{}),onClick:s=>{s.preventDefault(),e.zoomOut()}}),n.jsx(p.Box,{border:{color:"border-weak",side:"top"},children:t&&n.jsx(p.Button,{a11yTitle:"Zoom to data",icon:n.jsx(T.Globe,{}),onClick:s=>{s.preventDefault(),e.flyToBounds(t,{duration:1.5})}})})]})})})};G.propTypes={locations:a.oneOfType([a.array,a.object])};const Z={default:{container:{align:"center",justify:"center",background:"background-front",border:{color:"border",size:"small"},elevation:"medium",flex:!1,round:"full"}}},U=j.deepMerge(Z,{default:{container:{height:{min:"25px",max:"25px"},width:{min:"25px",max:"25px"}}}}),$={pin:{...U},cluster:{...Z,size:{small:{container:{height:{min:"36px",max:"36px"},width:{min:"36px",max:"36px"}},label:{size:"small"}},medium:{container:{direction:"row-reverse",gap:"xxsmall",height:{min:"48px",max:"48px"},width:{min:"48px",max:"48px"}},label:{color:"text-strong",size:"medium",weight:500}},large:{container:{direction:"row-reverse",gap:"xxsmall",height:{min:"54px",max:"54px"},width:{min:"54px",max:"54px"}},label:{size:"medium"}}}},popup:{background:"background-front",border:{color:"border-weak",size:"xsmall"},gap:"xsmall",margin:"none",pad:"small",round:"xsmall"},tiles:{}},Q=({...r},e)=>{const t=v.leafletLayer({paint_rules:r.paintRules,...r});return C.createElementObject(t,e)},V=C.createTileLayerComponent(Q,C.updateGridLayer),I=({attribution:r,url:e,format:t,...i})=>{var c;const o=u.useContext(l.ThemeContext);let s=n.jsx(b.TileLayer,{attribution:r,url:e,...i});return t==="pmtiles"&&(s=n.jsx(V,{attribution:r,url:e,paintRules:((c=o.map)==null?void 0:c.tiles)&&v.paintRules({...v.light,...o.map.tiles}),...i})),s};I.propTypes={attribution:a.string,url:a.string.isRequired,format:a.oneOf(["pmtiles"])};const Y=l(b.MapContainer)`
  ${({theme:r})=>{var e,t;return`
      ${(t=(e=r==null?void 0:r.global)==null?void 0:e.font)!=null&&t.family?`font-family: ${r.global.font.family};`:""}
      height: 100%;
    `}}
`,W=u.forwardRef(({center:r=[0,0],children:e,maxZoom:t=20,minZoom:i=3,scrollWheelZoom:o=!0,tileLayer:s,theme:c,zoom:g=1,zoomControl:h=!1,...d},m)=>{const x=u.useContext(l.ThemeContext),f=j.deepMerge(x,{map:j.deepMerge($,c)});return n.jsx(l.ThemeContext.Provider,{value:f,children:n.jsxs(Y,{attributionControl:!1,center:r,ref:m,scrollWheelZoom:o,maxZoom:t,minZoom:i,zoom:g,zoomControl:h,...d,children:[n.jsx(b.AttributionControl,{position:"bottomright",prefix:!1}),n.jsx(I,{attribution:s.attribution,url:s.url,format:s.format,...s}),e]})})});W.propTypes={center:a.array,children:a.any,scrollWheelZoom:a.string||a.bool,maxZoom:a.number,minZoom:a.number,tileLayer:a.shape({attribution:a.string,url:a.string.isRequired,format:a.oneOf(["pmtiles"])}).isRequired,theme:a.object,zoom:a.number,zoomControl:a.bool};const X=({icon:r,popup:e,...t})=>{var c;const i=u.useContext(l.ThemeContext),o=(c=r==null?void 0:r.props)==null?void 0:c.kind,s=e?n.jsx(b.Popup,{children:n.jsx(q,{children:e})}):void 0;return n.jsx(b.Marker,{icon:y.divIcon({className:"grommet-marker",html:k.renderToString(n.jsx(l.ThemeContext.Provider,{value:i,children:r||n.jsx(S,{})}))}),kind:o,...t,children:s},J.v4())};X.propTypes={icon:a.node,popup:a.node};const ee=({...r},e)=>{const t=new y.MarkerClusterGroup({showCoverageOnHover:!1,zoomToBoundsOnClick:!1,...r});return C.createElementObject(t,C.extendContext(e,{layerContainer:t}))},te=C.createPathComponent(ee),A=({icon:r,popup:e,...t})=>{const i=u.useContext(l.ThemeContext);return n.jsx(te,{iconCreateFunction:o=>{if(e){const s=o.bindPopup(k.renderToString(n.jsx(l.ThemeContext.Provider,{value:i,children:n.jsx(q,{children:e({cluster:o})})})));o.on("click",()=>{s.openPopup()})}return y.divIcon({className:"grommet-cluster-group",html:k.renderToString(n.jsx(l.ThemeContext.Provider,{value:i,children:r?u.cloneElement(r({cluster:o}),{cluster:o}):n.jsx(B,{cluster:o})}))})},...t})};A.propTypes={icon:a.func,popup:a.func};const re=l(p.Box)`
  // to create the pin shape
  border-bottom-right-radius: 0;
  // translate to re-align with leaflet div
  transform: rotate(45deg) translateX(-35%);
  &:hover {
    transform: rotate(45deg) translateX(-35%) scale(1.1);
    transition: transform 0.4s;
  }
`,S=({kind:r="default"})=>{var o,s,c,g,h,d,m,x,f;const e=u.useContext(l.ThemeContext),t=M([(c=(s=(o=e==null?void 0:e.map)==null?void 0:o.pin)==null?void 0:s.default)==null?void 0:c.container,(d=(h=(g=e==null?void 0:e.map)==null?void 0:g.pin)==null?void 0:h[r])==null?void 0:d.container]);let i=(f=(x=(m=e==null?void 0:e.map)==null?void 0:m.pin)==null?void 0:x[r])==null?void 0:f.icon;return i&&(i=u.cloneElement(i,{style:{transform:"rotate(-45deg)"}})),n.jsx(re,{...t,children:i})};S.propTypes={kind:a.string};const q=({...r})=>{var t;const e=u.useContext(l.ThemeContext);return n.jsx(p.Box,{...(t=e==null?void 0:e.map)==null?void 0:t.popup,...r})};window.console=console;const oe=console.error,ne=["useLayoutEffect does nothing on the server, because its effect cannot"];console.error=function(e,...t){ne.some(i=>e.includes(i))||oe(e,...t)};exports.Cluster=B;exports.Controls=G;exports.LocationBounds=D;exports.Map=W;exports.Marker=X;exports.MarkerCluster=A;exports.Pin=S;exports.Popup=q;exports.base=$;exports.normalizeTheme=M;
